# Story 1.4: Frontend Login Page

**Story ID:** 1.4
**Assigned to:** @dev
**Sprint:** Sprint 1 (Week 1)
**Status:** Draft
**Estimation:** 5 story points (1.5 days)

---

## Summary

Complete the login page implementation with full authentication flow: form submission, token storage, error handling, and redirect to dashboard on success.

---

## Acceptance Criteria

- [ ] Login page fully functional
  - [ ] Email input field with validation
  - [ ] Password input field with masking
  - [ ] Submit button
  - [ ] Form validation (required fields)
- [ ] Authentication flow
  - [ ] POST to /api/auth/login with credentials
  - [ ] Token stored in Zustand auth store
  - [ ] Token stored in localStorage
  - [ ] User object stored in state
  - [ ] isAuthenticated flag set
- [ ] Error handling
  - [ ] Display error message on login failure
  - [ ] 401 Unauthorized → "Invalid email or password"
  - [ ] Network error → "Connection failed. Please try again"
  - [ ] Clear error when user starts typing
- [ ] Navigation
  - [ ] Successful login → redirect to /projects
  - [ ] Already logged in → skip login page
  - [ ] Session timeout → redirect to /login
- [ ] Styling
  - [ ] Form centered on page
  - [ ] Professional appearance (Tailwind)
  - [ ] Responsive on mobile
  - [ ] Loading spinner during submission
- [ ] Tests passing: `npm test` (80%+ coverage)

---

## Tasks

### Task 1: Enhance Login Component (1 day)
- [ ] Update `src/pages/Login.tsx`
  - [ ] Accept any email with password "password" (demo mode)
  - [ ] Add form validation
  - [ ] Add isLoading state
  - [ ] Add error state
  - [ ] Call api.post('/auth/login', {email, password})
  - [ ] Handle response → setAuth(user, token)
  - [ ] Handle error → display message
  - [ ] Disable submit button while loading
  - [ ] Show loading spinner
- [ ] Test manually
  - [ ] Valid credentials → success
  - [ ] Wrong password → error message
  - [ ] Missing email → validation error

### Task 2: Implement Auth Store
- [ ] Auth store already created in `src/store/authStore.ts`
  - [ ] Verify setAuth() works
  - [ ] Verify clearAuth() works
  - [ ] Verify localStorage integration
  - [ ] Test persistence across browser reload
- [ ] Verify isAuthenticated computed correctly

### Task 3: Implement Protected Routes
- [ ] App.tsx already has ProtectedRoute wrapper
  - [ ] Verify it checks isAuthenticated
  - [ ] Verify it redirects to /login if not authenticated
  - [ ] Test by manually deleting token from localStorage
- [ ] Add private route guard
  - [ ] Also protect against localStorage token without auth store

### Task 4: Session Management
- [ ] Implement token refresh (Phase 2 - not MVP)
- [ ] Implement logout
  - [ ] Add logout button to navigation
  - [ ] Call clearAuth() on click
  - [ ] Redirect to /login
- [ ] Handle 401 in API interceptor
  - [ ] Already done in api.ts
  - [ ] Verify it clears token on 401 response

### Task 5: Write Tests
- [ ] Create `src/tests/components/Login.test.tsx`
  - [ ] Test form renders
  - [ ] Test form validation
  - [ ] Test login submission
  - [ ] Test success redirect
  - [ ] Test error display
  - [ ] Test loading state
- [ ] Create `src/tests/hooks/useAuth.test.ts`
  - [ ] Test setAuth stores token
  - [ ] Test clearAuth removes token
  - [ ] Test persistence
- [ ] Min 80% coverage

---

## Dev Notes

**Backend Required:**
- Story 1.2 (Auth endpoint) must be running
- Backend must return TokenResponse with access_token + user

**API Contract:**
```json
POST /api/auth/login
{
  "email": "user@example.com",
  "password": "password"
}

Response (200):
{
  "access_token": "eyJ...",
  "token_type": "bearer",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "User Name",
    "role": "director",
    "projects": []
  }
}

Error (401):
{
  "error": "authentication_failed",
  "detail": "Invalid email or password"
}
```

**Demo Mode:**
- Accept any email with password "password"
- Test accounts: test@example.com, gabriela@soubim.com, etc.

**Security Notes:**
- Never log passwords
- Token stored in memory + localStorage
- localStorage helps persistence across page refreshes
- Zustand store is authoritative (in-memory)

---

## File List

**Modified/Created:**
- `src/pages/Login.tsx` (modify) - Full implementation
- `src/store/authStore.ts` (existing - verify works)
- `src/services/api.ts` (existing - verify interceptors)
- `src/tests/components/Login.test.tsx` (new) - Unit tests
- `src/tests/hooks/useAuth.test.ts` (new) - Hook tests
- `src/App.tsx` (existing - verify protected routes)

---

## Completion Notes

_Fill in after completing the story_

- **Date Completed:**
- **Actual Points:**
- **Issues Encountered:**
- **Lessons Learned:**

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-07 | Created story |

---

**Related Stories:** 1.2 (Auth endpoint), 1.5 (Projects page)
**Blocked By:** 1.2 (need working backend auth)
**Blocks:** 1.5 (projects page needs login working)
