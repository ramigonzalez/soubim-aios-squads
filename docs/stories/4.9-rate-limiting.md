# Story 4.9: Rate Limiting

**Story ID:** 4.9
**Assigned to:** @dev
**Sprint:** Sprint 6 (Week 8)
**Status:** Draft
**Estimation:** 3 story points (1-2 days)

---

## Summary

Implement rate limiting on sensitive endpoints using slowapi library to prevent brute-force attacks. Auth endpoints limited to 5 req/min per IP, general API limited to 100 req/min per user.

---

## Acceptance Criteria

- [ ] Rate limiting configured:
  - [ ] Auth endpoints: 5 requests/min per IP
  - [ ] General API: 100 requests/min per user
- [ ] Returns 429 (Too Many Requests) when exceeded
- [ ] Response headers:
  - [ ] X-RateLimit-Limit
  - [ ] X-RateLimit-Remaining
  - [ ] X-RateLimit-Reset
- [ ] Backoff hint in error response
- [ ] Tests passing: `pytest tests/api/test_rate_limiting.py`

---

## Tasks

### Task 1: Install and Configure slowapi (0.5 days)

```python
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter

@app.post("/api/auth/login")
@limiter.limit("5/minute")
async def login(request: Request, ...):
    # Max 5 login attempts per minute
    pass

@app.get("/api/projects")
@limiter.limit("100/minute")
async def list_projects(request: Request, ...):
    # Max 100 API calls per minute
    pass
```

### Task 2: Write Tests (0.5 days)

```python
def test_rate_limit_enforced(client):
    for i in range(6):
        response = client.post(
            "/api/auth/login",
            json={"email": "test@ex.com", "password": "wrong"}
        )
    assert response.status_code == 429
    assert "X-RateLimit-Limit" in response.headers

def test_rate_limit_resets(client):
    # Make 5 requests
    for i in range(5):
        client.post("/api/auth/login", json={"email": "test@ex.com", "password": "pw"})
    
    # Wait for reset
    time.sleep(61)
    
    # Should work again
    response = client.post("/api/auth/login", json={"email": "test@ex.com", "password": "pw"})
    assert response.status_code in [200, 401]
```

---

**Related Stories:** 4.2 (JWT Auth), 4.8 (Security Headers)
**Blocked By:** None
**Blocks:** None
