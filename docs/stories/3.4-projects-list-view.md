# Story 3.4: Projects List View

**Story ID:** 3.4
**Assigned to:** @dev
**Sprint:** Sprint 4 (Week 6)
**Status:** Draft
**Estimation:** 5 story points (2-3 days)

---

## Summary

Create a projects list view that displays all accessible projects in a grid layout with project cards showing key metrics, decision counts, and last activity. Includes empty state, loading state, and navigation to project detail pages.

---

## UX Research Context

This story creates the entry point for project exploration and directly supports:

**Research Insight 2: Digest vs. Deep Dive Split**
- Gabriela (Director) needs quick access to all projects with key metrics at a glance
- Project cards show summary information (team size, decision count, last activity)
- Quick scan-ability is critical for busy executives

**Research Insight 4: Mobile-First for Gabriela During Maternity**
- Projects page must be fully responsive (mobile/tablet/desktop)
- Grid adapts: 1 column (mobile 375px) → 2 columns (tablet 768px) → 3 columns (desktop 1024px+)
- Touch-friendly card targets (minimum 44px tap area)

**Design System: Shadcn/ui Card Component**
- Use Shadcn/ui `Card` component for project cards
- Consistent elevation, hover states, and spacing
- WCAG AA compliant contrast ratios and interactive states

**Component Architecture: Atomic Design**
- **Page:** ProjectsPage (page-level component)
- **Organism:** ProjectsGrid (grid layout with cards)
- **Molecule:** ProjectCard (composed card with metrics)
- **Atoms:** Card, Badge, Button (from Shadcn/ui)

**User Flow:**
1. User logs in → Lands on Projects List
2. Scans project cards for relevant project
3. Clicks card → Navigates to Project Detail (Story 3.5)

**Reference:** `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` (Part 1: User Personas, Gabriela workflow)

---

## Acceptance Criteria

### Data Fetching & Display
- [ ] Projects fetched from `/api/projects` on page load using React Query
- [ ] React Query cache configured (5 min stale time, retry once)
- [ ] Project cards display using Shadcn/ui `Card` component:
  - [ ] Project name (CardTitle, max 2 lines with ellipsis)
  - [ ] Description (CardDescription, truncated to 100 chars, max 2 lines)
  - [ ] Team member count (with Users icon from lucide-react)
  - [ ] Total decision count (with FileText icon)
  - [ ] Last decision date (relative time with Clock icon, e.g., "2 days ago")
  - [ ] Project created date (absolute date, small text)

### Responsive Grid Layout (Mobile-First from UX Research)
- [ ] Grid adapts to viewport:
  - [ ] Mobile (375px-767px): 1 column, full width
  - [ ] Tablet (768px-1023px): 2 columns, 24px gap
  - [ ] Desktop (1024px+): 3 columns, 24px gap
- [ ] Cards maintain consistent height within each row
- [ ] Proper spacing and padding on all breakpoints (4px mobile, 6px tablet, 8px desktop)

### Interaction & Navigation
- [ ] Click project card → Navigate to `/projects/:id`
- [ ] Hover state visible on desktop (shadow elevation increase)
- [ ] Touch-friendly targets on mobile (card minimum 80px height)
- [ ] Focus visible for keyboard navigation (Shadcn/ui default styles)
- [ ] Active/pressed state on card click

### Loading, Empty, and Error States
- [ ] Loading state with skeleton cards (6 skeletons matching card layout)
- [ ] Skeleton animation (Tailwind animate-pulse)
- [ ] Empty state when no projects exist:
  - [ ] Icon (briefcase/folder from lucide-react)
  - [ ] Heading: "No projects"
  - [ ] Description: "You don't have access to any projects yet."
- [ ] Error handling with retry button:
  - [ ] Shadcn/ui Alert component (destructive variant)
  - [ ] Error message displayed
  - [ ] Retry button triggers refetch

### Accessibility (WCAG 2.1 AA)
- [ ] Semantic HTML (main, header, section, article for cards)
- [ ] ARIA labels for icons (aria-label on Users, FileText, Clock icons)
- [ ] Keyboard navigation (Tab through cards, Enter to open)
- [ ] Focus visible styles (Shadcn/ui default focus ring)
- [ ] Color contrast ≥4.5:1 for all text
- [ ] Screen reader friendly (card title, description, metrics read in order)

### Performance
- [ ] Initial load <2 seconds (from UX success metrics)
- [ ] Smooth grid layout (no layout shift, CLS <0.1)
- [ ] Skeleton cards appear immediately (no white flash)

### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration test: Projects fetched and displayed
- [ ] Test: Empty state rendering
- [ ] Test: Error state with retry
- [ ] Test: Card click navigation
- [ ] Test: Responsive grid at all breakpoints

---

## Tasks

### Task 1: Create Projects Page Component (1 day)

1. **Create `src/pages/Projects.tsx`**
   ```typescript
   import { useQuery } from '@tanstack/react-query'
   import { api } from '../services/api'
   import { Header } from '../components/Header'
   import { ProjectCard } from '../components/ProjectCard'
   import { ProjectCardSkeleton } from '../components/ProjectCard'
   import { Alert, AlertDescription } from '../components/ui/alert'
   import { Button } from '../components/ui/button'
   import { getErrorMessage } from '../lib/errors'

   export function ProjectsPage() {
     const {
       data: projectsData,
       isLoading,
       isError,
       error,
       refetch
     } = useQuery({
       queryKey: ['projects'],
       queryFn: () => api.getProjects(),
     })

     return (
       <div className="min-h-screen bg-gray-50">
         <Header />

         <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
           <div className="mb-8">
             <h1 className="text-3xl font-bold text-gray-900">Projects</h1>
             <p className="mt-2 text-gray-600">
               View and manage your architectural projects
             </p>
           </div>

           {isError && (
             <Alert variant="destructive" className="mb-6">
               <AlertDescription className="flex items-center justify-between">
                 <span>{getErrorMessage(error)}</span>
                 <Button variant="outline" size="sm" onClick={() => refetch()}>
                   Retry
                 </Button>
               </AlertDescription>
             </Alert>
           )}

           {isLoading ? (
             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
               {[1, 2, 3, 4, 5, 6].map((i) => (
                 <ProjectCardSkeleton key={i} />
               ))}
             </div>
           ) : projectsData?.projects.length === 0 ? (
             <EmptyState />
           ) : (
             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
               {projectsData?.projects.map((project) => (
                 <ProjectCard key={project.id} project={project} />
               ))}
             </div>
           )}

           {projectsData && projectsData.projects.length > 0 && (
             <div className="mt-6 text-sm text-gray-500 text-center">
               Showing {projectsData.projects.length} of {projectsData.total} projects
             </div>
           )}
         </main>
       </div>
     )
   }

   function EmptyState() {
     return (
       <div className="text-center py-12">
         <div className="mx-auto h-24 w-24 text-gray-400">
           <svg
             fill="none"
             stroke="currentColor"
             viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg"
           >
             <path
               strokeLinecap="round"
               strokeLinejoin="round"
               strokeWidth={2}
               d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
             />
           </svg>
         </div>
         <h3 className="mt-4 text-lg font-medium text-gray-900">No projects</h3>
         <p className="mt-2 text-gray-500">
           You don't have access to any projects yet.
         </p>
       </div>
     )
   }
   ```

### Task 2: Create Project Card Component (0.75 days)

1. **Create `src/components/ProjectCard.tsx`**
   ```typescript
   import { useNavigate } from 'react-router-dom'
   import { Project } from '../types'
   import { formatDate } from '../lib/utils'
   import { formatDistanceToNow } from 'date-fns'
   import { Card, CardHeader, CardTitle, CardDescription, CardContent } from './ui/card'
   import { Users, FileText, Clock } from 'lucide-react'

   interface Props {
     project: Project
   }

   export function ProjectCard({ project }: Props) {
     const navigate = useNavigate()

     const handleClick = () => {
       navigate(`/projects/${project.id}`)
     }

     const latestDecisionTime = project.latest_decision
       ? formatDistanceToNow(new Date(project.latest_decision), { addSuffix: true })
       : 'No decisions yet'

     return (
       <Card
         className="cursor-pointer hover:shadow-lg transition-shadow"
         onClick={handleClick}
       >
         <CardHeader>
           <CardTitle className="text-xl">{project.name}</CardTitle>
           <CardDescription className="line-clamp-2">
             {project.description || 'No description'}
           </CardDescription>
         </CardHeader>

         <CardContent>
           <div className="space-y-3">
             <div className="flex items-center text-sm text-gray-600">
               <Users className="h-4 w-4 mr-2" />
               <span>{project.member_count} team members</span>
             </div>

             <div className="flex items-center text-sm text-gray-600">
               <FileText className="h-4 w-4 mr-2" />
               <span>{project.decision_count} decisions</span>
             </div>

             <div className="flex items-center text-sm text-gray-600">
               <Clock className="h-4 w-4 mr-2" />
               <span>Updated {latestDecisionTime}</span>
             </div>

             <div className="pt-3 border-t text-xs text-gray-500">
               Created {formatDate(project.created_at)}
             </div>
           </div>
         </CardContent>
       </Card>
     )
   }

   export function ProjectCardSkeleton() {
     return (
       <Card>
         <CardHeader>
           <div className="h-6 bg-gray-200 rounded animate-pulse mb-2" />
           <div className="h-4 bg-gray-200 rounded animate-pulse w-3/4" />
         </CardHeader>

         <CardContent>
           <div className="space-y-3">
             <div className="h-4 bg-gray-200 rounded animate-pulse" />
             <div className="h-4 bg-gray-200 rounded animate-pulse" />
             <div className="h-4 bg-gray-200 rounded animate-pulse w-2/3" />
           </div>
         </CardContent>
       </Card>
     )
   }
   ```

2. **Verify Shadcn/ui components installed (from Story 3.1)**
   ```bash
   # Already installed in Story 3.1:
   # - Card (CardHeader, CardTitle, CardDescription, CardContent)
   # - Alert (for error state)
   # - Button (for retry button)
   # - date-fns (for formatDistanceToNow)

   # If not already installed:
   npx shadcn-ui@latest add card
   npx shadcn-ui@latest add alert
   npx shadcn-ui@latest add button
   npm install date-fns
   npm install lucide-react  # For icons
   ```

### Task 3: Add Placeholder Pages (0.25 days)

1. **Create `src/pages/ProjectDetail.tsx` (placeholder)**
   ```typescript
   import { useParams } from 'react-router-dom'
   import { Header } from '../components/Header'

   export function ProjectDetailPage() {
     const { id } = useParams<{ id: string }>()

     return (
       <div className="min-h-screen bg-gray-50">
         <Header />

         <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
           <h1 className="text-3xl font-bold">Project Detail: {id}</h1>
           <p className="mt-4 text-gray-600">Coming soon in Story 3.5</p>
         </main>
       </div>
     )
   }
   ```

### Task 4: Add Loading and Error States (0.5 days)

1. **Update utility functions in `src/lib/utils.ts`**
   ```typescript
   import { type ClassValue, clsx } from "clsx"
   import { twMerge } from "tailwind-merge"

   export function cn(...inputs: ClassValue[]) {
     return twMerge(clsx(inputs))
   }

   export function formatDate(date: string): string {
     return new Date(date).toLocaleDateString('en-US', {
       year: 'numeric',
       month: 'short',
       day: 'numeric'
     })
   }

   export function formatDateTime(date: string): string {
     return new Date(date).toLocaleString('en-US', {
       year: 'numeric',
       month: 'short',
       day: 'numeric',
       hour: '2-digit',
       minute: '2-digit'
     })
   }

   export function truncate(str: string, length: number): string {
     if (str.length <= length) return str
     return str.slice(0, length) + '...'
   }
   ```

2. **Add retry logic to React Query**
   ```typescript
   // Already configured in App.tsx
   const queryClient = new QueryClient({
     defaultOptions: {
       queries: {
         refetchOnWindowFocus: false,
         retry: 1,
         staleTime: 5 * 60 * 1000,
       },
     },
   })
   ```

### Task 5: Write Tests (0.5 days)

1. **Create `tests/pages/Projects.test.tsx`**
   ```typescript
   import { describe, it, expect, vi } from 'vitest'
   import { render, screen, waitFor } from '@testing-library/react'
   import { BrowserRouter } from 'react-router-dom'
   import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
   import { ProjectsPage } from '../../src/pages/Projects'
   import { api } from '../../src/services/api'

   vi.mock('../../src/services/api')

   const queryClient = new QueryClient({
     defaultOptions: { queries: { retry: false } },
   })

   const wrapper = ({ children }: { children: React.ReactNode }) => (
     <QueryClientProvider client={queryClient}>
       <BrowserRouter>
         {children}
       </BrowserRouter>
     </QueryClientProvider>
   )

   describe('ProjectsPage', () => {
     it('displays loading state initially', () => {
       vi.mocked(api.getProjects).mockImplementation(
         () => new Promise(() => {}) // Never resolves
       )

       render(<ProjectsPage />, { wrapper })

       expect(screen.getByText('Projects')).toBeInTheDocument()
       // Skeleton cards should be visible
     })

     it('displays projects when loaded', async () => {
       const mockProjects = {
         projects: [
           {
             id: '1',
             name: 'Test Project',
             description: 'Test description',
             created_at: '2026-01-01T00:00:00Z',
             member_count: 5,
             decision_count: 42,
             latest_decision: '2026-02-01T00:00:00Z',
           },
         ],
         total: 1,
         limit: 50,
         offset: 0,
       }

       vi.mocked(api.getProjects).mockResolvedValue(mockProjects)

       render(<ProjectsPage />, { wrapper })

       await waitFor(() => {
         expect(screen.getByText('Test Project')).toBeInTheDocument()
         expect(screen.getByText('Test description')).toBeInTheDocument()
         expect(screen.getByText(/5 team members/i)).toBeInTheDocument()
         expect(screen.getByText(/42 decisions/i)).toBeInTheDocument()
       })
     })

     it('displays empty state when no projects', async () => {
       vi.mocked(api.getProjects).mockResolvedValue({
         projects: [],
         total: 0,
         limit: 50,
         offset: 0,
       })

       render(<ProjectsPage />, { wrapper })

       await waitFor(() => {
         expect(screen.getByText(/no projects/i)).toBeInTheDocument()
       })
     })

     it('displays error state on failure', async () => {
       vi.mocked(api.getProjects).mockRejectedValue(new Error('Network error'))

       render(<ProjectsPage />, { wrapper })

       await waitFor(() => {
         expect(screen.getByText(/network error/i)).toBeInTheDocument()
         expect(screen.getByRole('button', { name: /retry/i })).toBeInTheDocument()
       })
     })
   })
   ```

2. **Create `tests/components/ProjectCard.test.tsx`**
   ```typescript
   import { describe, it, expect, vi } from 'vitest'
   import { render, screen, fireEvent } from '@testing-library/react'
   import { BrowserRouter } from 'react-router-dom'
   import { ProjectCard } from '../../src/components/ProjectCard'

   const mockNavigate = vi.fn()
   vi.mock('react-router-dom', async () => {
     const actual = await vi.importActual('react-router-dom')
     return {
       ...actual,
       useNavigate: () => mockNavigate,
     }
   })

   const mockProject = {
     id: '1',
     name: 'Test Project',
     description: 'Test description for this project',
     created_at: '2026-01-01T00:00:00Z',
     member_count: 5,
     decision_count: 42,
     latest_decision: '2026-02-01T00:00:00Z',
   }

   describe('ProjectCard', () => {
     it('renders project information correctly', () => {
       render(
         <BrowserRouter>
           <ProjectCard project={mockProject} />
         </BrowserRouter>
       )

       expect(screen.getByText('Test Project')).toBeInTheDocument()
       expect(screen.getByText('Test description for this project')).toBeInTheDocument()
       expect(screen.getByText(/5 team members/i)).toBeInTheDocument()
       expect(screen.getByText(/42 decisions/i)).toBeInTheDocument()
     })

     it('navigates to project detail on click', () => {
       render(
         <BrowserRouter>
           <ProjectCard project={mockProject} />
         </BrowserRouter>
       )

       const card = screen.getByText('Test Project').closest('div[class*="cursor-pointer"]')
       fireEvent.click(card!)

       expect(mockNavigate).toHaveBeenCalledWith('/projects/1')
     })

     it('handles missing description', () => {
       const projectNoDesc = { ...mockProject, description: null }

       render(
         <BrowserRouter>
           <ProjectCard project={projectNoDesc} />
         </BrowserRouter>
       )

       expect(screen.getByText('No description')).toBeInTheDocument()
     })
   })
   ```

---

## Dev Notes

### Component Architecture (Atomic Design)

```
ProjectsPage (Page)
├── Header (Organism - navigation + logout)
├── PageHeader (Molecule - title + description)
├── ErrorAlert (Molecule - Shadcn/ui Alert + retry Button)
├── LoadingGrid (Molecule - 6 ProjectCardSkeletons)
├── EmptyState (Molecule - icon + heading + description)
└── ProjectsGrid (Organism)
    └── ProjectCard (Molecule) [repeating]
        ├── CardHeader (Shadcn/ui - Atom)
        │   ├── CardTitle (project name)
        │   └── CardDescription (truncated description)
        └── CardContent (Shadcn/ui - Atom)
            ├── MetricRow (team members + Users icon)
            ├── MetricRow (decision count + FileText icon)
            ├── MetricRow (last activity + Clock icon)
            └── CreatedDate (small text)
```

**Component File Locations (Atomic Design):**
- `src/pages/Projects.tsx` - Page component
- `src/components/molecules/ProjectCard.tsx` - Project card molecule
- `src/components/atoms/` - Shadcn/ui components (Card, Alert, Button)
- `src/components/organisms/Header.tsx` - Navigation header

### Responsive Grid (Mobile-First from UX Research)

```css
/* Tailwind classes - Mobile-first approach */
grid grid-cols-1           /* Mobile (375px+): 1 column */
md:grid-cols-2             /* Tablet (768px+): 2 columns */
lg:grid-cols-3             /* Desktop (1024px+): 3 columns */
gap-6                      /* 24px gap between cards */

/* Container padding - responsive */
px-4                       /* Mobile: 16px */
sm:px-6                    /* Tablet: 24px */
lg:px-8                    /* Desktop: 32px */

/* Card minimum touch target (UX Research: Insight 4) */
min-h-[80px]               /* Minimum height for touch-friendly targets */
```

**Breakpoints (from UX Research):**
- Mobile: 375px-767px (1 column, portrait phones)
- Tablet: 768px-1023px (2 columns, iPad portrait)
- Desktop: 1024px+ (3 columns, laptop/desktop)

### Data Flow

```
1. Page loads → useQuery('projects')
2. Show skeleton loading state
3. Fetch from API → api.getProjects()
4. Store in React Query cache (5 min stale time)
5. Render ProjectCard for each project
6. Click card → Navigate to /projects/:id
```

---

## File List

**Modified/Created (Atomic Design Structure):**
- `src/pages/Projects.tsx` (new) - Projects list page component
- `src/pages/ProjectDetail.tsx` (new) - Placeholder for Story 3.5
- `src/components/molecules/ProjectCard.tsx` (new) - Project card molecule
- `src/components/organisms/Header.tsx` (new) - Navigation header organism
- `src/lib/utils.ts` (modify) - Add formatting utilities (already updated in Story 3.1)
- `tests/pages/Projects.test.tsx` (new) - Page integration tests
- `tests/components/ProjectCard.test.tsx` (new) - Component unit tests
- `package.json` (modify) - Verify date-fns, lucide-react installed

---

## Testing Strategy

### Unit Tests

```typescript
// Test coverage areas:
- ✅ Projects page rendering
- ✅ Loading state display
- ✅ Projects list display
- ✅ Empty state handling
- ✅ Error state with retry
- ✅ Project card rendering
- ✅ Card click navigation
- ✅ Date formatting
- ✅ Responsive grid layout
```

### Manual Testing

```bash
# Test scenarios
1. Start dev server: npm run dev
2. Login and navigate to /projects
3. Verify projects display in grid
4. Click a project card (should navigate)
5. Test responsive design (resize browser)
6. Test empty state (if no projects)
7. Test error state (disconnect network)
```

### Coverage Target

- Minimum: 80%
- Target: 90%+
- Run: `npm run test -- --coverage`

---

## UX Design System References

**Primary Documentation:**
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - User personas (Gabriela workflow), responsive design requirements
- `docs/ux/REQUIREMENTS-TRANSLATION-GUIDE.md` - Atomic Design component hierarchy
- `docs/ux/AIOS-WORKFLOW-INTEGRATION.md` - Component architecture patterns

**Key Sections:**
- User Persona 1 (Gabriela): `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Part 1
- Mobile-First Requirements: `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Insight 4
- Atomic Design: `REQUIREMENTS-TRANSLATION-GUIDE.md` → Part 3
- Responsive Breakpoints: Story 3.1 → Tailwind Config

**Shadcn/ui Components Used:**
- Card: https://ui.shadcn.com/docs/components/card
- Alert: https://ui.shadcn.com/docs/components/alert
- Button: https://ui.shadcn.com/docs/components/button

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-08 | Created story |
| 2026-02-08 | Updated with UX design system guidelines (Shadcn/ui Card, Atomic Design, mobile-first, WCAG AA) |

---

**Related Stories:** 3.1 (Frontend Setup), 3.3 (Authentication), 3.5 (Timeline), 3.10 (Responsive Design)
**Blocked By:** 3.1 (Frontend Setup), 3.3 (Authentication)
**Blocks:** 3.5 (Timeline - needs project selection)
