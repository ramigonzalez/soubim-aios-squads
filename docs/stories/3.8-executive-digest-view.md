# Story 3.8: Gabriela's Executive Digest View

**Story ID:** 3.8
**Assigned to:** @dev
**Sprint:** Sprint 5 (Week 7)
**Status:** Draft
**Estimation:** 5 story points (2-3 days)

---

## Summary

Build an executive digest view that summarizes decisions in a given time period, categorized by type (structural, cost, timeline, risks), with quick stats and printable layout for Gabriela's weekly review.

---

## UX Research Context

This story implements the **"Digest" view for Gabriela (Director)** and directly supports:

**Research Insight 2: Digest vs. Deep Dive Split ⭐⭐ (Primary)**
- **Critical Finding:** Gabriela and Architects need **completely different UX patterns**
- **Gabriela (Director) needs:**
  - **Executive digest:** 1-page summary, <30 min catch-up time
  - High-level metrics: Total decisions, meetings, consensus %, high-impact count
  - Categorized highlights: "What changed?" (structural, cost, timeline, risks)
  - **Scan-ability:** Quick visual scan to understand project health
  - **Printable:** Print 1-2 pages for offline review during morning coffee
- **Contrast to Timeline (Story 3.5):** Architects need full chronological detail
- **Design goal:** Gabriela spends 15+ hours/week freed for sales (from 30+ hours in meetings)

**User Persona: Gabriela (Director)**
- **Role:** Director, 1 user, manages 9 architects across 3 teams
- **Pain point:** "I'm drowning in meetings, need to delegate but don't trust decisions made without me"
- **Job-to-be-done:** "Catch up on project decisions quickly during maternity leave (2-3 months)"
- **Critical user flow:**
  1. Morning: Check DecisionLog on iPad over coffee (10-15 min)
  2. Scan Executive Digest: Last 7 days of decisions
  3. Quick stats: "42 decisions, 8 meetings, 85% consensus → healthy"
  4. Highlights: "3 timeline shifts, 2 cost impacts → review these"
  5. Click highlight → Open drill-down modal (Story 3.7) if needed
  6. Print digest for offline review (optional)
- **Success metric:** Catch-up time <30 min per project, 85%+ decision autonomy

**Research Insight 4: Mobile-First for Gabriela During Maternity**
- Digest must work on **iPad** (Gabriela's primary device during maternity leave)
- **Responsive design:**
  - Mobile (375px): 1-column stats, stacked categories
  - Tablet (768px): 2-column stats, compact categories
  - Desktop (1024px+): 4-column stats, grid categories
- **Print-friendly:** A4/Letter layout, <2 pages, optimized for reading

**Research Insight 1: Trust Through Transparency**
- Digest provides transparency into ALL decisions (not filtered or hidden)
- Links to full timeline for deep dive when needed
- Anomaly flags highlighted (warnings for unusual decisions)

**Design System: Shadcn/ui Card + Badge Components**
- **Card:** Metric cards (4 stats: decisions, meetings, consensus, high-impact)
- **Badge:** Category badges (structural, cost, timeline, risk)
- **Alert:** Anomaly flags or warnings
- **Button:** Print button, "View full timeline" link

**Component Architecture: Atomic Design**
- **Page:** DigestPage (page-level component with date range picker, stats, categories)
- **Organisms:** DigestStats (4 metric cards), DigestHighlights (categorized decision summaries)
- **Molecules:** StatCard (individual metric card), HighlightCategory (category with top decisions)
- **Atoms:** Card, Badge, Button, Select (from Shadcn/ui)

**User Flow:**
1. Gabriela logs in → Selects project
2. Clicks "Digest" tab (or default landing page)
3. Sees date range: "Last 7 days" (default), can change to "Last 30 days", "Custom range"
4. Scans Quick Stats: 42 decisions, 8 meetings, 85% consensus, 5 high-impact
5. Scans Highlights:
   - Structural Changes: 3 decisions (collapsed, expandable)
   - Cost Impacts: 2 decisions (+$25k total)
   - Timeline Shifts: 3 decisions (+1 week total)
   - Risk Flags: 2 anomalies (high dissent)
6. Clicks "Timeline Shifts" → Expands to see top 3 timeline decisions
7. Clicks decision → Opens drill-down modal (Story 3.7)
8. **Result:** Gabriela understands project health in <15 min, catches up efficiently

**Performance Requirements (from UX Success Metrics):**
- Digest load: <2 seconds
- Print-friendly: <2 pages optimized for A4/Letter
- Catch-up time: <30 min per project (user-side metric)

**Reference:** `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` (Part 2: Insight 2 "Digest vs. Deep Dive Split")

---

## Acceptance Criteria

### Page Structure & Layout
- [ ] DigestPage component (Page-level) with clean, scan-able layout
- [ ] Page header:
  - [ ] Project name (text-2xl font-bold)
  - [ ] "Executive Digest" heading
  - [ ] Date range selector (Shadcn/ui `Select` or date picker)
- [ ] Page sections:
  - [ ] Quick Stats (4 metric cards)
  - [ ] Highlights by Category (4 categories with expandable lists)
  - [ ] Footer: Generated timestamp, "View full timeline" link, Print button

### Date Range Selector
- [ ] Date range options (Shadcn/ui `Select` dropdown):
  - [ ] "Last 7 days" (default)
  - [ ] "Last 30 days"
  - [ ] "Last 90 days"
  - [ ] "Custom range" (opens date picker with from/to dates)
- [ ] Fetches digest data when date range changes
- [ ] Display selected date range clearly: "Jan 1 - Jan 7, 2026"

### Quick Stats Section (UX Insight 2: High-Level Metrics)
- [ ] 4 metric cards displayed in responsive grid:
  - **Desktop (1024px+):** 4 columns (25% width each)
  - **Tablet (768px):** 2 columns (50% width each)
  - **Mobile (375px):** 1 column (100% width, stacked)
- [ ] Each StatCard (Molecule) displays:
  - [ ] Metric value (large number, text-4xl font-bold)
  - [ ] Metric label (small text, text-sm text-gray-600)
  - [ ] Icon (from lucide-react): FileText, Users, CheckCircle, AlertTriangle
  - [ ] Background color or badge for visual distinction
- [ ] **4 metrics:**
  1. **Total Decisions:** Count of all decisions in date range
     - Icon: FileText
     - Example: "42 decisions"
  2. **Meetings:** Count of meetings
     - Icon: Users
     - Example: "8 meetings"
  3. **Consensus %:** Percentage of decisions with high consensus (all AGREE)
     - Icon: CheckCircle
     - Example: "85% consensus"
     - Color-coded: >80% green, 60-80% amber, <60% red
  4. **High-Impact Decisions:** Count of decisions with high timeline/budget impact
     - Icon: AlertTriangle
     - Example: "5 high-impact"
     - Color-coded: Red if >10, amber if 5-10, gray if <5

### Highlights by Category (UX Insight 2: Categorized Summaries)
- [ ] 4 categories displayed as expandable sections (Shadcn/ui `Accordion` or custom collapsible):
  1. **Structural Changes:** Decisions affecting structure, design, materials
  2. **Cost Impacts:** Decisions with budget changes (+ or -)
  3. **Timeline Shifts:** Decisions with schedule changes (+ or - days/weeks)
  4. **Risk Flags:** Decisions with anomaly flags or high dissent
- [ ] Each HighlightCategory (Molecule) displays:
  - [ ] Category title + count badge (e.g., "Timeline Shifts (3)")
  - [ ] Expand/collapse button (chevron icon)
  - [ ] When expanded: Top 3-5 decisions in category
- [ ] Each decision in category shows:
  - [ ] Decision statement (truncated to 1-2 lines)
  - [ ] Impact summary (e.g., "+1 week", "-$5k", "High dissent")
  - [ ] Clickable: Opens drill-down modal (Story 3.7)
  - [ ] Discipline badge (Tailwind `discipline-*` colors)
- [ ] Categories collapsed by default (Gabriela expands only categories of interest)

### Data Fetching & API Integration
- [ ] Fetch digest from `/api/projects/{id}/digest?date_from=X&date_to=Y`
- [ ] React Query integration: `useQuery(['digest', projectId, dateRange])`
- [ ] Loading state: Skeleton cards matching stats + categories layout
- [ ] Error state: Shadcn/ui `Alert` with retry button
- [ ] Empty state: "No decisions in this date range" message

### Links & Navigation
- [ ] Each decision in highlights clickable:
  - [ ] Click decision → Opens drill-down modal (Story 3.7) with decision details
  - [ ] Modal overlays digest (digest remains visible behind modal)
- [ ] "View full timeline" link:
  - [ ] Positioned at bottom of digest or in header
  - [ ] Navigates to Timeline view (Story 3.5) with same project and date filter applied
  - [ ] Shadcn/ui `Button` (variant=outline)

### Printable Layout (UX Requirement: <2 Pages)
- [ ] Print-friendly CSS (`@media print` rules):
  - [ ] Remove navigation, sidebar, header (keep only digest content)
  - [ ] Font size: 11pt (readable but compact)
  - [ ] Page breaks: Avoid breaking stat cards mid-card
  - [ ] Margins: 0.5in (A4/Letter standard)
  - [ ] Target: <2 pages for 7-day digest
- [ ] Print button:
  - [ ] Shadcn/ui `Button` with Print icon (lucide-react `Printer`)
  - [ ] Triggers browser print dialog: `window.print()`
  - [ ] Positioned in page header (top-right)
- [ ] Print header: Project name, date range, generated timestamp
- [ ] Print footer: Page number (if >1 page)

### Responsive Design (UX Insight 4: Mobile-First for Gabriela)
- [ ] **Mobile (375px-767px):**
  - [ ] Stats: 1 column, stacked vertically
  - [ ] Categories: Full width, collapsible
  - [ ] Date range: Full width selector
  - [ ] Padding: px-4 (16px)
- [ ] **Tablet (768px-1023px):**
  - [ ] Stats: 2 columns (2x2 grid)
  - [ ] Categories: Full width or 2 columns (optional)
  - [ ] Padding: px-6 (24px)
- [ ] **Desktop (1024px+):**
  - [ ] Stats: 4 columns (1x4 grid)
  - [ ] Categories: Full width or 2 columns (2x2 grid)
  - [ ] Padding: px-8 (32px)

### Accessibility (WCAG 2.1 AA)
- [ ] Semantic HTML:
  - [ ] `<main>` for digest content
  - [ ] `<section>` for stats and categories
  - [ ] `<h1>`, `<h2>`, `<h3>` for headings (proper hierarchy)
- [ ] ARIA labels:
  - [ ] Stat cards: `aria-label="Total decisions: 42"`
  - [ ] Expand/collapse buttons: `aria-expanded` state
  - [ ] Print button: `aria-label="Print digest"`
- [ ] Keyboard navigation:
  - [ ] Tab through stats, categories, decisions
  - [ ] Enter to expand/collapse categories
  - [ ] Enter to open drill-down modal on decision click
- [ ] Color contrast ≥4.5:1 for all text
- [ ] Screen reader friendly: Stats and categories announced in logical order

### Performance (UX Success Metric)
- [ ] Digest load: <2 seconds (from page load to full content visible)
- [ ] No layout shift: CLS <0.1 (skeleton cards match final layout)
- [ ] Print generation: <3 seconds (from button click to print dialog)

### Testing
- [ ] Unit tests >80% coverage:
  - [ ] Digest page renders
  - [ ] Date range selection updates digest
  - [ ] Stats display correct values
  - [ ] Categories display top decisions
  - [ ] Print button triggers print dialog
  - [ ] Decisions clickable (opens modal)
  - [ ] Empty state when no decisions
  - [ ] Error state with retry
- [ ] Integration test: Fetch digest → Display stats + categories
- [ ] Print test: Print layout fits <2 pages
- [ ] Responsive test: Mobile (375px), Tablet (768px), Desktop (1024px+)
- [ ] Accessibility test: Keyboard navigation, screen reader

### Optional Phase 1.5 Features (Defer if Time-Constrained)
- [ ] Export to PDF button (download digest as PDF file)
- [ ] Email digest button (send digest to Gabriela's email)
- [ ] Charts/visualizations (consensus trend over time, decisions by discipline pie chart)
  - Use Chart.js or Recharts library if implemented

---

## Tasks

### Task 1: Create Digest Page Component (1 day)

Create `src/pages/Digest.tsx` with date range picker, stats dashboard, and categorized decision highlights using Chart.js or Recharts for visualizations.

### Task 2: Fetch Digest Data (0.5 days)

Integrate with digest API endpoint, handle date range changes, implement loading/error states, and add retry logic.

### Task 3: Create Printable Layout (0.5 days)

Add print-specific CSS, optimize for paper layout (A4/Letter), remove unnecessary UI elements in print mode, and add print button.

### Task 4: Add Highlight Categories (0.75 days)

Group decisions by impact type (structural, cost, timeline, risk), display top decisions per category, and add visual indicators for severity.

### Task 5: Write Tests (0.25 days)

Test digest rendering, date range selection, stats calculation, category display, and print layout.

---

## Dev Notes

### Digest Layout (Atomic Design + UX Research)

```
DigestPage (Page)
├── Page Header
│   ├── Project Name (text-2xl font-bold)
│   ├── "Executive Digest" Heading
│   ├── Date Range Selector (Shadcn/ui Select)
│   │   ├── "Last 7 days" (default)
│   │   ├── "Last 30 days"
│   │   ├── "Last 90 days"
│   │   └── "Custom range" (date picker)
│   └── Print Button (top-right, Shadcn/ui Button + Printer icon)
│
├── DigestStats (Organism)
│   ├── Responsive Grid: 4 columns (desktop), 2 columns (tablet), 1 column (mobile)
│   │
│   ├── StatCard: "Total Decisions" (Molecule)
│   │   ├── Icon: FileText (lucide-react)
│   │   ├── Value: "42" (text-4xl font-bold)
│   │   └── Label: "decisions" (text-sm text-gray-600)
│   │
│   ├── StatCard: "Meetings" (Molecule)
│   │   ├── Icon: Users
│   │   ├── Value: "8"
│   │   └── Label: "meetings"
│   │
│   ├── StatCard: "Consensus %" (Molecule)
│   │   ├── Icon: CheckCircle
│   │   ├── Value: "85%" (color-coded: green if >80%, amber if 60-80%, red if <60%)
│   │   └── Label: "consensus"
│   │
│   └── StatCard: "High-Impact" (Molecule)
│       ├── Icon: AlertTriangle
│       ├── Value: "5" (color-coded: red if >10, amber if 5-10, gray if <5)
│       └── Label: "high-impact"
│
├── DigestHighlights (Organism)
│   ├── HighlightCategory: "Structural Changes" (Molecule)
│   │   ├── Category Header
│   │   │   ├── Title: "Structural Changes"
│   │   │   ├── Count Badge: "(3)" (Shadcn/ui Badge)
│   │   │   └── Expand/Collapse Chevron
│   │   └── Decision List (when expanded)
│   │       ├── DecisionSummaryCard (Molecule) [repeating, top 3-5]
│   │       │   ├── Decision statement (truncated to 2 lines)
│   │       │   ├── Impact summary: "Changed material to steel"
│   │       │   ├── Discipline badge (Tailwind discipline-* color)
│   │       │   └── Clickable (opens DrillDownModal, Story 3.7)
│   │       └── ...
│   │
│   ├── HighlightCategory: "Cost Impacts"
│   │   ├── Category Header: "Cost Impacts (2)"
│   │   ├── Total impact: "+$25k" (displayed in header)
│   │   └── Decision List: Top 2 cost decisions
│   │
│   ├── HighlightCategory: "Timeline Shifts"
│   │   ├── Category Header: "Timeline Shifts (3)"
│   │   ├── Total impact: "+1 week" (displayed in header)
│   │   └── Decision List: Top 3 timeline decisions
│   │
│   └── HighlightCategory: "Risk Flags"
│       ├── Category Header: "Risk Flags (2)"
│       ├── Alert icon (red warning)
│       └── Decision List: Top 2 decisions with anomaly flags
│
├── Page Footer
│   ├── Generated Timestamp: "Generated on Feb 8, 2026 at 10:30 AM"
│   ├── "View full timeline" Link (Shadcn/ui Button, variant=outline)
│   │   └── Navigates to Timeline (Story 3.5) with date filter applied
│   └── Print Button (Shadcn/ui Button + Printer icon)
│
└── Data Fetching (React Query)
    └── useQuery(['digest', projectId, dateRange])
        └── GET /api/projects/{id}/digest?date_from=X&date_to=Y
```

**Component File Locations:**
- `src/pages/Digest.tsx` - Main digest page
- `src/components/organisms/DigestStats.tsx` - Quick stats grid organism
- `src/components/molecules/StatCard.tsx` - Individual stat card molecule
- `src/components/organisms/DigestHighlights.tsx` - Categorized highlights organism
- `src/components/molecules/HighlightCategory.tsx` - Category with top decisions
- `src/components/molecules/DecisionSummaryCard.tsx` - Decision preview card
- `src/hooks/useDigest.ts` - React Query hook for digest API
- `src/styles/print.css` - Print-specific CSS

### Print Styling (UX Requirement: <2 Pages)

```css
/* src/styles/print.css */
@media print {
  /* Hide UI elements not needed in print */
  .no-print,
  nav,
  .sidebar,
  button,
  .print-button {
    display: none !important;
  }

  /* Optimize for paper */
  body {
    font-size: 11pt;
    line-height: 1.4;
    color: #000;
    background: #fff;
  }

  /* Page margins */
  @page {
    margin: 0.5in;
    size: letter; /* or A4 */
  }

  /* Prevent card breaks */
  .stat-card,
  .highlight-category {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* Page breaks between major sections */
  .digest-highlights {
    page-break-before: auto;
  }

  /* Ensure colors print properly */
  .discipline-badge,
  .consensus-badge {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Print header */
  .print-header {
    display: block;
    margin-bottom: 1rem;
  }

  /* Print footer */
  .print-footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    text-align: center;
    font-size: 9pt;
    color: #666;
  }
}
```

### API Response Structure (Digest Endpoint)

```json
{
  "project_id": "uuid",
  "date_from": "2026-01-01",
  "date_to": "2026-01-07",
  "stats": {
    "total_decisions": 42,
    "meetings_count": 8,
    "consensus_percentage": 0.85,
    "high_impact_count": 5
  },
  "highlights": {
    "structural_changes": [
      {
        "id": "uuid",
        "statement": "Changed material from concrete to steel",
        "discipline": "Architecture",
        "impact_summary": "Material change",
        "timestamp": "00:23:15",
        "who": "Carlos"
      }
      // ... top 3-5 structural decisions
    ],
    "cost_impacts": [
      {
        "id": "uuid",
        "statement": "Added sustainability features",
        "impact_summary": "+$15,000",
        "total_cost_change": 15000
      }
      // ... top 3-5 cost decisions
    ],
    "timeline_shifts": [
      {
        "id": "uuid",
        "statement": "Delayed steel fabrication",
        "impact_summary": "+2 weeks",
        "total_timeline_change_days": 14
      }
      // ... top 3-5 timeline decisions
    ],
    "risk_flags": [
      {
        "id": "uuid",
        "statement": "High dissent on foundation approach",
        "anomaly_flags": [
          {
            "type": "high_dissent",
            "severity": "high",
            "description": "Structural team strongly disagreed"
          }
        ]
      }
      // ... top 3-5 risk decisions
    ]
  },
  "generated_at": "2026-02-08T10:30:00Z"
}
```

---

## File List

**Modified/Created (Atomic Design Structure):**
- `src/pages/Digest.tsx` (new) - Main digest page component
- `src/components/organisms/DigestStats.tsx` (new) - Quick stats grid organism
- `src/components/molecules/StatCard.tsx` (new) - Individual stat card molecule
- `src/components/organisms/DigestHighlights.tsx` (new) - Categorized highlights organism
- `src/components/molecules/HighlightCategory.tsx` (new) - Category with top decisions molecule
- `src/components/molecules/DecisionSummaryCard.tsx` (new) - Decision preview card molecule
- `src/hooks/useDigest.ts` (new) - React Query hook for digest API
- `src/styles/print.css` (new) - Print-specific CSS (`@media print` rules)
- `tests/pages/Digest.test.tsx` (new) - Digest page tests
- `tests/components/DigestStats.test.tsx` (new) - Stats component tests
- `tests/components/HighlightCategory.test.tsx` (new) - Category component tests
- `package.json` (verify) - Ensure lucide-react installed for icons

---

## Testing Strategy

- ✅ Digest page rendering
- ✅ Date range selection
- ✅ Stats display
- ✅ Category grouping
- ✅ Print layout
- ✅ Empty state handling

---

## UX Design System References

**Primary Documentation:**
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - **Part 2: Insight 2 "Digest vs. Deep Dive Split"** (PRIMARY)
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - Part 1: User Persona 1 (Gabriela - Director)
- `docs/ux/REQUIREMENTS-TRANSLATION-GUIDE.md` - Story 3.8 example (Executive Digest)
- Story 3.1 - Tailwind config with discipline/consensus/impact colors

**Key Sections:**
- User Persona 1 (Gabriela): `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Part 1
- Digest vs. Deep Dive: `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Insight 2
- Success Metrics (Gabriela): `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Gabriela section (catch-up time <30 min)
- Responsive Design: Story 3.10 (Responsive Design)

**Shadcn/ui Components Used:**
- Card: https://ui.shadcn.com/docs/components/card (Stat cards, category cards)
- Select: https://ui.shadcn.com/docs/components/select (Date range selector)
- Badge: https://ui.shadcn.com/docs/components/badge (Category count, discipline badges)
- Button: https://ui.shadcn.com/docs/components/button (Print button, "View timeline" link)
- Accordion: https://ui.shadcn.com/docs/components/accordion (Expandable categories, optional)
- Alert: https://ui.shadcn.com/docs/components/alert (Risk flags, anomaly warnings)

**Icons Used (lucide-react):**
- FileText (total decisions)
- Users (meetings)
- CheckCircle (consensus %)
- AlertTriangle (high-impact)
- Printer (print button)
- Calendar (date range)

**Design Rationale:**
- **Why digest view?** Gabriela (Director) needs high-level summary, not full detail (UX Insight 2)
- **Why 4 metrics?** Quick scan-ability, project health at a glance (<30 sec to understand status)
- **Why categories?** Gabriela cares about **what changed** (structural, cost, timeline, risks), not chronology
- **Why printable?** Gabriela reviews offline during morning coffee, needs paper copy
- **Why <2 pages?** Busy executive, no time to read long reports (success metric: <30 min catch-up)
- **Why collapsible categories?** Progressive disclosure, Gabriela expands only categories of interest
- **Why consensus %?** Indicator of team alignment, low consensus = red flag requiring attention
- **Why link to timeline?** If Gabriela needs deep dive, opens Timeline (Story 3.5) with same date filter

**Contrast to Timeline (Story 3.5):**
- **Timeline (Architects):** Full chronological detail, all decisions, drill-down for learning
- **Digest (Gabriela):** High-level summary, categorized by impact type, quick scan for oversight

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-08 | Created story |
| 2026-02-08 | Updated with UX design system guidelines (Shadcn/ui Card/Select, Atomic Design, Insight 2 Digest vs Deep Dive, mobile-first, print-friendly, WCAG AA) |

---

**Related Stories:** 3.1 (Frontend Setup), 3.7 (Drill-down Modal - triggered from decision clicks), 3.9 (Digest API), 3.10 (Responsive Design)
**Blocked By:** 3.1 (Frontend Setup), 3.9 (Digest API endpoint must exist)
**Blocks:** None (alternative view for Gabriela, complements Timeline)
