# Story 4.6: Password Security & Hashing

**Story ID:** 4.6
**Assigned to:** @dev
**Sprint:** Sprint 6 (Week 8)
**Status:** Draft
**Estimation:** 3 story points (1-2 days)

---

## Summary

Implement secure password hashing using bcrypt with cost factor 12, ensure no plaintext passwords are stored, add password strength validation, and create utility functions for hashing and verification.

---

## Acceptance Criteria

- [ ] bcrypt hashing implemented (passlib library)
- [ ] Hash cost factor: 12 rounds
- [ ] No plaintext passwords in database (verified)
- [ ] Password strength validation:
  - [ ] Minimum 8 characters
  - [ ] At least one uppercase, lowercase, digit
  - [ ] Special characters recommended
- [ ] Password hash uniqueness (same password â†’ different hashes)
- [ ] Verification function working
- [ ] Tests passing: `pytest tests/unit/test_password.py`

---

## Tasks

### Task 1: Create Password Utilities (0.5 days)

```python
# app/utils/password.py
from passlib.context import CryptContext
import re

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def hash_password(password: str) -> str:
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def validate_password_strength(password: str) -> tuple[bool, str]:
    if len(password) < 8:
        return False, "Password must be at least 8 characters"
    if not re.search(r"[A-Z]", password):
        return False, "Password must contain uppercase letter"
    if not re.search(r"[a-z]", password):
        return False, "Password must contain lowercase letter"
    if not re.search(r"\d", password):
        return False, "Password must contain digit"
    return True, "Password is strong"
```

### Task 2: Update User Creation (0.25 days)

Ensure all user creation paths use `hash_password()` and never store plaintext.

### Task 3: Write Tests (0.25 days)

```python
def test_password_hashing():
    plain = "MyPassword123"
    hashed = hash_password(plain)
    assert hashed != plain
    assert verify_password(plain, hashed)

def test_hash_uniqueness():
    plain = "password"
    hash1 = hash_password(plain)
    hash2 = hash_password(plain)
    assert hash1 != hash2

def test_password_strength():
    valid, msg = validate_password_strength("Weak")
    assert not valid
    
    valid, msg = validate_password_strength("StrongPass123")
    assert valid
```

---

**Related Stories:** 4.2 (JWT Auth)
**Blocked By:** 4.1
**Blocks:** None
