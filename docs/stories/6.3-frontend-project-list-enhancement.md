# Story 6.3: Frontend — Project List Enhancement

**Story ID:** 6.3
**Epic:** E6 — Project Management Foundation
**Assigned to:** @dev
**Sprint:** Sprint 2 (Week 3)
**Status:** Ready for Review
**Estimation:** 3 story points (1 day)

---

## Summary

Enhance the existing Projects List page with: a "Create Project" button in the header, current stage badge on each project card, project_type label, item count (replacing decision_count), and an empty state for new users. This is a lightweight enhancement to the existing `ProjectCard` component and `Projects` page.

---

## Acceptance Criteria

### Project Cards Enhancement
- [x] `ProjectCard` shows current stage name as a `StagePill` badge (e.g., "Estudo Preliminar")
  - [x] `StagePill` styled: `text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-medium`
  - [x] "Current" indicator: small dot before stage name (`w-1.5 h-1.5 rounded-full bg-blue-500`)
  - [x] If no stages defined: show `text-gray-400 text-xs` "No stages"
- [x] Project_type label shown: `text-xs text-gray-500 uppercase tracking-wide`
- [x] Item count replaces decision count: "127 items" instead of "127 decisions"
- [x] Card shows latest item date (not just latest decision date)

### Create Project Button
- [x] "Create Project" button in page header, right-aligned
- [x] Styled: `bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2`
- [x] Icon: `Plus` from lucide-react
- [x] Navigates to `/projects/new`
- [ ] Only visible to admin/director role users

### Sorting
- [ ] Sort projects by: name, created_at, current stage (dropdown or toggle)
- [x] Default sort: `created_at DESC` (newest first)

### Empty State
- [x] When user has no projects:
  - [x] Large icon: `FolderPlus` from lucide-react
  - [x] Heading: "Create your first project"
  - [x] Description: "Set up a project with a stage schedule to start capturing project items."
  - [x] CTA button: "Create Project" → `/projects/new`
  - [x] Centered, bordered/dashed container

### Backward Compatibility
- [x] V1 projects (without stages) render correctly — show "No stages" instead of badge
- [x] V1 projects show item_count from API (falls back to decision_count if needed)

---

## Tasks

### Task 1: Create StagePill Atom (0.25 days)

1. **Create `src/components/molecules/StagePill.tsx`**
   ```typescript
   interface StagePillProps {
     stageName: string
     isCurrent?: boolean
   }

   export function StagePill({ stageName, isCurrent }: StagePillProps) {
     return (
       <span className="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-medium">
         {isCurrent && <span className="w-1.5 h-1.5 rounded-full bg-blue-500" />}
         {stageName}
       </span>
     )
   }
   ```

### Task 2: Update ProjectCard Component (0.25 days)

1. **Modify `src/components/common/ProjectCard.tsx`**
   - Add `currentStage?: {name: string}` to props
   - Add `projectType?: string` to props
   - Add `itemCount?: number` to props
   - Render `StagePill` when current_stage exists
   - Render project_type label
   - Update count display from "decisions" to "items"

### Task 3: Update Projects Page (0.25 days)

1. **Modify `src/pages/Projects.tsx`**
   - Add "Create Project" button in header (admin only)
   - Add sort dropdown
   - Add empty state component
   - Pass new props to ProjectCard from API response

### Task 4: Write Tests (0.25 days)

1. **Update `src/tests/components/ProjectCard.test.tsx`**
   - Card shows stage pill when current_stage exists
   - Card shows "No stages" when no stages
   - Card shows project_type label
   - Card shows item count

2. **Update `src/tests/pages/Projects.test.tsx`**
   - Create button visible for admin
   - Create button hidden for non-admin
   - Empty state renders when no projects
   - Sort toggle works

---

## Dev Notes

### Updated ProjectCard Layout

```
┌─────────────────────────────────────────────┐
│ Residential Tower Alpha           [StagePill]│
│ ARCHITECTURE FULL                            │
│                                              │
│ 50-floor residential tower...                │
│                                              │
│ 127 items · Last activity: Feb 15, 2026      │
└─────────────────────────────────────────────┘
```

### API Response Mapping

The extended `GET /api/projects` response (from Story 6.1) provides:
- `current_stage.name` → StagePill
- `project_type` → uppercase label
- `item_count` → count display

For V1 projects (pre-stages), these fields will be `null` — handle gracefully.

---

## File List

**New Files:**
- `src/components/molecules/StagePill.tsx` — Stage badge component
- `src/tests/components/StagePill.test.tsx` — 4 tests for StagePill

**Modified Files:**
- `src/components/common/ProjectCard.tsx` — V2: StagePill, project_type label, item count (backward compat)
- `src/pages/Projects.tsx` — Create Project button, FolderPlus empty state, pagination
- `src/App.tsx` — Routes for create/edit pages
- `src/tests/components/ProjectCard.test.tsx` — Updated for V2 (items, stages, project_type)
- `src/tests/pages/Projects.test.tsx` — Updated empty state text

---

## Testing Strategy

### Unit Tests
```
- ✅ StagePill renders stage name
- ✅ StagePill shows current indicator dot
- ✅ ProjectCard with stage/type/count
- ✅ ProjectCard without stages (graceful fallback)
- ✅ Create button admin-only visibility
- ✅ Empty state rendering
- ✅ Sort dropdown functionality
```

### Coverage Target
- 80%+

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-16 | Created story |

---

**Related Stories:** 6.1 (Backend API), 6.2 (Create Form)
**Blocked By:** 6.1 (API must return current_stage, project_type, item_count)
**Blocks:** None
