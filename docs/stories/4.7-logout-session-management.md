# Story 4.7: Logout & Session Management

**Story ID:** 4.7
**Assigned to:** @dev
**Sprint:** Sprint 6 (Week 8)
**Status:** Draft
**Estimation:** 3 story points (1-2 days)

---

## Summary

Implement logout endpoint that clears access token cookie, document session timeout behavior (tokens valid until expiration), and ensure secure session cleanup.

---

## Acceptance Criteria

- [ ] `POST /api/auth/logout` endpoint created
- [ ] Clears access token cookie (Max-Age=0)
- [ ] Returns 200 OK
- [ ] Tokens remain valid until expiration (stateless JWT)
- [ ] Optional: Token blacklist (Redis) for immediate revocation
- [ ] Session timeout: 24 hours (configured in JWT)
- [ ] Tests passing: `pytest tests/api/test_logout.py`

---

## Tasks

### Task 1: Create Logout Endpoint (0.5 days)

```python
@router.post("/logout")
async def logout(response: Response):
    response.delete_cookie("access_token")
    return {"message": "Logged out successfully"}
```

### Task 2: Optional Token Blacklist (1 day)

```python
# Optional: Implement Redis-based token blacklist
import redis
r = redis.Redis()

def revoke_token(token: str):
    # Add to blacklist with expiration
    r.setex(f"blacklist:{token}", 86400, "1")

def is_token_revoked(token: str) -> bool:
    return r.exists(f"blacklist:{token}")
```

### Task 3: Write Tests (0.5 days)

```python
def test_logout_clears_cookie(client, auth_token):
    response = client.post(
        "/api/auth/logout",
        cookies={"access_token": auth_token}
    )
    assert response.status_code == 200
    assert "access_token" not in response.cookies

def test_cannot_access_after_logout(client, auth_token):
    client.post("/api/auth/logout", cookies={"access_token": auth_token})
    response = client.get("/api/projects", cookies={"access_token": auth_token})
    # Token still valid (stateless), but cookie cleared
```

---

**Related Stories:** 4.2 (JWT Auth)
**Blocked By:** 4.2
**Blocks:** None
