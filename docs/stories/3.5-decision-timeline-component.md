# Story 3.5: Decision Timeline Component

**Story ID:** 3.5
**Assigned to:** @dev
**Sprint:** Sprint 5 (Week 7)
**Status:** Draft
**Estimation:** 8 story points (3-4 days)

---

## Summary

Build the decision timeline component that displays project decisions chronologically, grouped by meetings, with discipline badges, consensus indicators, and impact levels. Includes virtual scrolling for performance with 200+ decisions.

---

## UX Research Context

This story implements the **"Deep Dive" view** for Architects and directly supports multiple research insights:

**Research Insight 2: Digest vs. Deep Dive Split ⭐⭐ (Primary)**
- **For Architects:** Full chronological timeline with detailed decision information
- Architects need to **discover and explore** decisions across the entire project
- Contrast to Executive Digest (Story 3.8) which is a high-level summary for Gabriela
- Timeline is the primary workspace for day-to-day architect work

**Research Insight 3: Discipline-First Mental Model**
- Architects think in discipline silos: "Show me all MEP decisions affecting architecture"
- Discipline badges must be **prominent** and color-coded (Architecture=Blue, MEP=Orange, etc.)
- Visual scanning by color is critical for quick identification
- Works with Filters (Story 3.6) to narrow by discipline

**Research Insight 1: Trust Through Transparency**
- Full visibility into every decision made in meetings
- Click decision card → Open drill-down modal (Story 3.7) for full reasoning + transcript
- No hidden decisions, complete audit trail

**Research Insight 4: Mobile-First for Gabriela During Maternity**
- Timeline must work on iPad (768px) and mobile (375px)
- Responsive card layout with touch-friendly targets (min 44px)
- Meeting groups collapse/expand on mobile for better scannability

**Design System: Shadcn/ui Card + Badge Components**
- Decision cards use Shadcn/ui `Card` with hover states
- Discipline/consensus/impact badges use Shadcn/ui `Badge` with custom colors
- Color system from Tailwind config (Story 3.1):
  - Discipline: `discipline-architecture`, `discipline-mep`, etc.
  - Consensus: `consensus-agree`, `consensus-mixed`, `consensus-dissent`
  - Impact: `impact-high`, `impact-medium`, `impact-low`

**Component Architecture: Atomic Design**
- **Organism:** Timeline (complex feature with data fetching, grouping, state)
- **Molecule:** MeetingGroup (meeting header + decision cards)
- **Molecule:** DecisionCard (composed card with badges and metadata)
- **Atoms:** Card, Badge, Button (from Shadcn/ui)

**User Flow:**
1. User selects project → Lands on Project Detail page with Timeline
2. Scans timeline by discipline color or meeting date
3. Clicks decision card → Opens drill-down modal (Story 3.7)
4. Uses filters (Story 3.6) to narrow decisions by discipline/date/impact

**Performance Requirements (from UX Success Metrics):**
- Dashboard load: <2 seconds (200+ decisions)
- Virtual scrolling if >200 decisions
- Smooth scroll: 60 fps

**Reference:** `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` (Part 2: Insight 2 "Digest vs. Deep Dive")

---

## Acceptance Criteria

### Data Fetching & Display
- [ ] Fetch decisions from `/api/projects/{id}/decisions` using React Query
- [ ] Display decisions chronologically (default: newest → oldest)
- [ ] Optional: Sort toggle button (newest ↔ oldest) - can defer to Phase 2
- [ ] React Query caching (5 min stale time) to avoid refetching
- [ ] Timeline header shows total decision count

### Meeting Grouping (UX Insight 3: Discipline-First)
- [ ] Group decisions by `meeting_date` automatically
- [ ] Meeting headers display using Shadcn/ui styling:
  - [ ] Meeting date (formatted: "Feb 1, 2026")
  - [ ] Meeting type badge (Shadcn/ui `Badge` with custom colors):
    - Client: blue background
    - Multi-disciplinary: purple background
    - Internal: gray background
  - [ ] Decision count for this meeting (e.g., "5 decisions")
  - [ ] Meeting header visually distinct from decision cards (light gray background)
- [ ] Meetings ordered chronologically (newest first)
- [ ] Visual separator between meetings (border or spacing)

### Decision Cards (UX Insight 2: Deep Dive for Architects)
- [ ] Each decision card uses Shadcn/ui `Card` component
- [ ] Decision cards display:
  - [ ] **Discipline badge** (prominent, top-left, using Tailwind `discipline-*` colors):
    - Architecture: `bg-discipline-architecture` (#3B82F6 blue)
    - MEP: `bg-discipline-mep` (#F97316 orange)
    - Landscape: `bg-discipline-landscape` (#10B981 green)
    - Structural: `bg-discipline-structural` (#8B5CF6 purple)
    - Electrical: `bg-discipline-electrical` (#F59E0B amber)
    - Plumbing: `bg-discipline-plumbing` (#06B6D4 cyan)
  - [ ] **Decision statement** (CardTitle, max 3 lines with ellipsis, font-medium text-gray-900)
  - [ ] **Who made decision** (speaker name, text-sm text-gray-600)
  - [ ] **Timestamp in meeting** (HH:MM:SS format, text-sm text-gray-600)
  - [ ] **Consensus indicator** (Shadcn/ui `Badge` with Tailwind `consensus-*` colors):
    - High consensus (all AGREE): `bg-consensus-agree` (#10B981 green)
    - Medium consensus (some MIXED): `bg-consensus-mixed` (#F59E0B amber)
    - Low consensus (DISSENT): `bg-consensus-dissent` (#EF4444 red)
  - [ ] **Impact level badge** (if impacts exist, using Tailwind `impact-*` colors):
    - High: `bg-impact-high` (#DC2626 red)
    - Medium: `bg-impact-medium` (#F59E0B amber)
    - Low: `bg-impact-low` (#9CA3AF gray)
  - [ ] **Confidence score** (percentage badge, e.g., "92% confidence", variant=outline)
  - [ ] **Anomaly flags** (if present, red badge with count, e.g., "⚠ 2 flags", variant=destructive)
  - [ ] **Chevron icon** (right side, indicates clickable, lucide-react ChevronRight)

### Interaction & Navigation (UX Insight 1: Transparency)
- [ ] Click decision card → Open drill-down modal (Story 3.7, passed decision ID)
- [ ] Hover state on decision card (shadow elevation increase, Shadcn/ui default)
- [ ] Cursor pointer on decision cards
- [ ] Focus visible for keyboard navigation (Shadcn/ui focus ring)
- [ ] No page reload when clicking card (modal opens inline)

### Responsive Design (UX Insight 4: Mobile-First)
- [ ] Timeline container responsive padding:
  - Mobile (375px-767px): `px-4` (16px)
  - Tablet (768px-1023px): `px-6` (24px)
  - Desktop (1024px+): `px-8` (32px)
- [ ] Decision cards adapt to viewport:
  - Mobile: Full width, compact spacing
  - Tablet/Desktop: Max-width constraint, comfortable spacing
- [ ] Touch-friendly targets on mobile (card min height 80px, tap area ≥44px)
- [ ] Meeting headers collapse/expand on mobile (optional Phase 2 enhancement)
- [ ] Horizontal scroll disabled (all content wraps properly)

### Performance (UX Success Metric: <2s load)
- [ ] Initial timeline load <2 seconds for 200 decisions
- [ ] Virtual scrolling implemented IF >200 decisions (use react-window):
  - Defer to performance testing
  - If load time >2s with 200+ decisions, implement virtual scrolling
- [ ] Skeleton loading state displays immediately (no white flash)
- [ ] Smooth scroll performance (60 fps, no janky scrolling)
- [ ] Images/icons lazy-loaded (if applicable)

### Loading, Empty, and Error States
- [ ] Loading state with skeleton cards (3 meeting groups with 2 cards each):
  - Skeleton mimics meeting header (gray bar, pulsing animation)
  - Skeleton decision cards (gray rectangles, pulsing animation)
  - Tailwind `animate-pulse` for shimmer effect
- [ ] Empty state when no decisions:
  - Icon (Calendar or FileText from lucide-react)
  - Heading: "No decisions yet"
  - Description: "Decisions will appear here once meetings are processed"
  - Bordered/dashed container for visual distinction
- [ ] Error state with retry button:
  - Shadcn/ui `Alert` component (variant=destructive)
  - Error message displayed
  - Retry button (Shadcn/ui `Button`, variant=outline)
  - Triggers React Query refetch on click

### Accessibility (WCAG 2.1 AA)
- [ ] Semantic HTML:
  - `<main>` or `<section>` for timeline container
  - `<article>` for each decision card
  - `<h2>`, `<h3>` for headers (meeting date, decision statement)
- [ ] ARIA labels:
  - Meeting headers: `aria-label="Meeting on {date}"`
  - Decision cards: `aria-label="Decision: {statement}"`
  - Icons: `aria-hidden="true"` with text labels nearby
- [ ] Keyboard navigation:
  - Tab through decision cards in order
  - Enter to open drill-down modal
  - Escape to close modal (in Story 3.7)
- [ ] Focus visible styles (Shadcn/ui default focus ring)
- [ ] Color contrast ≥4.5:1 for all text
- [ ] Screen reader friendly:
  - Decision card content reads in logical order
  - Badges announce meaningful labels (not just colors)

### Testing
- [ ] Unit tests >80% coverage:
  - Timeline component renders
  - Decisions grouped by meeting correctly
  - Meeting headers display correct data
  - Decision cards display all required fields
  - Discipline/consensus/impact colors correct
  - Empty state renders
  - Error state with retry
- [ ] Integration test: Fetch decisions → Display timeline
- [ ] Performance test: Load 200 decisions in <2 seconds
- [ ] Accessibility test: Keyboard navigation, screen reader
- [ ] Responsive test: Mobile (375px), Tablet (768px), Desktop (1024px+)

---

## Tasks

### Task 1: Create Timeline Component Structure (1 day)

1. **Create `src/components/Timeline.tsx`**
   ```typescript
   import { useParams } from 'react-router-dom'
   import { useQuery } from '@tanstack/react-query'
   import { useState } from 'react'
   import { api } from '../services/api'
   import { Decision } from '../types'
   import { DecisionCard } from './DecisionCard'
   import { MeetingGroup } from './MeetingGroup'
   import { Alert, AlertDescription } from './ui/alert'
   import { Button } from './ui/button'
   import { getErrorMessage } from '../lib/errors'

   export function Timeline() {
     const { id: projectId } = useParams<{ id: string }>()
     const [selectedDecision, setSelectedDecision] = useState<Decision | null>(null)

     const {
       data: decisionsData,
       isLoading,
       isError,
       error,
       refetch
     } = useQuery({
       queryKey: ['decisions', projectId],
       queryFn: () => api.getDecisions(projectId!, {}),
       enabled: !!projectId,
     })

     if (isLoading) {
       return <TimelineSkeleton />
     }

     if (isError) {
       return (
         <Alert variant="destructive">
           <AlertDescription className="flex items-center justify-between">
             <span>{getErrorMessage(error)}</span>
             <Button variant="outline" size="sm" onClick={() => refetch()}>
               Retry
             </Button>
           </AlertDescription>
         </Alert>
       )
     }

     if (!decisionsData || decisionsData.decisions.length === 0) {
       return <EmptyTimeline />
     }

     // Group decisions by meeting
     const groupedByMeeting = groupDecisionsByMeeting(decisionsData.decisions)

     return (
       <div className="space-y-6">
         <div className="flex items-center justify-between mb-4">
           <h2 className="text-2xl font-bold">Decision Timeline</h2>
           <div className="text-sm text-gray-500">
             {decisionsData.total} decisions
           </div>
         </div>

         <div className="space-y-8">
           {Object.entries(groupedByMeeting).map(([meetingDate, decisions]) => (
             <MeetingGroup
               key={meetingDate}
               meetingDate={meetingDate}
               decisions={decisions}
               onDecisionClick={setSelectedDecision}
             />
           ))}
         </div>

         {selectedDecision && (
           <DrillDownModal
             decision={selectedDecision}
             onClose={() => setSelectedDecision(null)}
           />
         )}
       </div>
     )
   }

   function groupDecisionsByMeeting(decisions: Decision[]) {
     return decisions.reduce((acc, decision) => {
       const key = decision.meeting_date
       if (!acc[key]) acc[key] = []
       acc[key].push(decision)
       return acc
     }, {} as Record<string, Decision[]>)
   }

   function EmptyTimeline() {
     return (
       <div className="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg">
         <h3 className="text-lg font-medium text-gray-900">No decisions yet</h3>
         <p className="mt-2 text-gray-500">
           Decisions will appear here once meetings are processed
         </p>
       </div>
     )
   }

   function TimelineSkeleton() {
     return (
       <div className="space-y-6">
         {[1, 2, 3].map((i) => (
           <div key={i} className="space-y-3">
             <div className="h-6 bg-gray-200 rounded animate-pulse w-1/4" />
             <div className="h-32 bg-gray-200 rounded animate-pulse" />
             <div className="h-32 bg-gray-200 rounded animate-pulse" />
           </div>
         ))}
       </div>
     )
   }
   ```

### Task 2: Create Meeting Group Component (0.75 days)

1. **Create `src/components/MeetingGroup.tsx`**
   ```typescript
   import { Decision } from '../types'
   import { DecisionCard } from './DecisionCard'
   import { formatDate } from '../lib/utils'
   import { Badge } from './ui/badge'
   import { Calendar, Clock, Users } from 'lucide-react'

   interface Props {
     meetingDate: string
     decisions: Decision[]
     onDecisionClick: (decision: Decision) => void
   }

   const MEETING_TYPE_COLORS = {
     client: 'bg-blue-100 text-blue-800',
     'multi-disciplinary': 'bg-purple-100 text-purple-800',
     internal: 'bg-gray-100 text-gray-800',
   }

   export function MeetingGroup({ meetingDate, decisions, onDecisionClick }: Props) {
     const firstDecision = decisions[0]
     const meetingType = firstDecision.meeting_type

     return (
       <div className="space-y-4">
         {/* Meeting Header */}
         <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
           <div className="flex items-center justify-between flex-wrap gap-4">
             <div className="flex items-center gap-4">
               <div className="flex items-center text-gray-700">
                 <Calendar className="h-4 w-4 mr-2" />
                 <span className="font-medium">{formatDate(meetingDate)}</span>
               </div>

               <Badge className={MEETING_TYPE_COLORS[meetingType as keyof typeof MEETING_TYPE_COLORS]}>
                 {meetingType}
               </Badge>
             </div>

             <div className="flex items-center gap-4 text-sm text-gray-600">
               <div className="flex items-center">
                 <Clock className="h-4 w-4 mr-1" />
                 <span>{decisions.length} decisions</span>
               </div>
             </div>
           </div>
         </div>

         {/* Decision Cards */}
         <div className="space-y-3 pl-4 border-l-2 border-gray-200">
           {decisions.map((decision) => (
             <DecisionCard
               key={decision.id}
               decision={decision}
               onClick={() => onDecisionClick(decision)}
             />
           ))}
         </div>
       </div>
     )
   }
   ```

2. **Install Shadcn badge component**
   ```bash
   npx shadcn-ui@latest add badge
   ```

### Task 3: Create Decision Card Component (1 day)

1. **Create `src/components/DecisionCard.tsx`**
   ```typescript
   import { Decision } from '../types'
   import { Badge } from './ui/badge'
   import { Card, CardContent } from './ui/card'
   import { ChevronRight } from 'lucide-react'

   interface Props {
     decision: Decision
     onClick: () => void
   }

   // Use Tailwind theme colors from Story 3.1 (tailwind.config.ts)
   const DISCIPLINE_COLORS = {
     architecture: 'bg-discipline-architecture/10 text-discipline-architecture border-discipline-architecture/30',
     mep: 'bg-discipline-mep/10 text-discipline-mep border-discipline-mep/30',
     landscape: 'bg-discipline-landscape/10 text-discipline-landscape border-discipline-landscape/30',
     structural: 'bg-discipline-structural/10 text-discipline-structural border-discipline-structural/30',
     electrical: 'bg-discipline-electrical/10 text-discipline-electrical border-discipline-electrical/30',
     plumbing: 'bg-discipline-plumbing/10 text-discipline-plumbing border-discipline-plumbing/30',
     general: 'bg-gray-100 text-gray-800 border-gray-300',
   }

   const CONSENSUS_COLORS = {
     high: 'bg-consensus-agree/10 text-consensus-agree border-consensus-agree/30',
     medium: 'bg-consensus-mixed/10 text-consensus-mixed border-consensus-mixed/30',
     low: 'bg-consensus-dissent/10 text-consensus-dissent border-consensus-dissent/30',
   }

   const IMPACT_COLORS = {
     high: 'bg-impact-high/10 text-impact-high border-impact-high/30',
     medium: 'bg-impact-medium/10 text-impact-medium border-impact-medium/30',
     low: 'bg-impact-low/10 text-impact-low border-impact-low/30',
   }

   export function DecisionCard({ decision, onClick }: Props) {
     const consensusLevel = getConsensusLevel(decision.consensus)
     const impactLevel = getImpactLevel(decision.impacts)

     return (
       <Card
         className="cursor-pointer hover:shadow-md transition-shadow"
         onClick={onClick}
       >
         <CardContent className="pt-6">
           <div className="flex items-start justify-between gap-4">
             <div className="flex-1">
               {/* Discipline Badge */}
               <Badge
                 variant="outline"
                 className={`mb-2 ${DISCIPLINE_COLORS[decision.discipline as keyof typeof DISCIPLINE_COLORS]}`}
               >
                 {decision.discipline}
               </Badge>

               {/* Decision Statement */}
               <h3 className="text-lg font-medium text-gray-900 mb-2">
                 {decision.decision_statement}
               </h3>

               {/* Metadata */}
               <div className="flex items-center gap-4 text-sm text-gray-600 mb-3">
                 <span>By {decision.who}</span>
                 <span>•</span>
                 <span>{decision.timestamp}</span>
               </div>

               {/* Badges Row */}
               <div className="flex items-center gap-2 flex-wrap">
                 <Badge className={CONSENSUS_COLORS[consensusLevel]}>
                   Consensus: {consensusLevel}
                 </Badge>

                 {impactLevel && (
                   <Badge className={IMPACT_COLORS[impactLevel]}>
                     Impact: {impactLevel}
                   </Badge>
                 )}

                 {decision.confidence && (
                   <Badge variant="outline">
                     {Math.round(decision.confidence * 100)}% confidence
                   </Badge>
                 )}

                 {decision.anomaly_flags && decision.anomaly_flags.length > 0 && (
                   <Badge variant="destructive">
                     ⚠ {decision.anomaly_flags.length} flags
                   </Badge>
                 )}
               </div>
             </div>

             <ChevronRight className="h-5 w-5 text-gray-400 flex-shrink-0" />
           </div>
         </CardContent>
       </Card>
     )
   }

   function getConsensusLevel(consensus: Record<string, string>): 'high' | 'medium' | 'low' {
     const values = Object.values(consensus)
     const agreeCount = values.filter((v) => v === 'AGREE').length
     const total = values.length

     if (agreeCount === total) return 'high'
     if (agreeCount >= total / 2) return 'medium'
     return 'low'
   }

   function getImpactLevel(impacts: any[]): 'high' | 'medium' | 'low' | null {
     if (!impacts || impacts.length === 0) return null

     // Simple heuristic: if timeline or budget impact mentioned, it's high
     const hasTimeline = impacts.some((i) => i.type === 'timeline')
     const hasBudget = impacts.some((i) => i.type === 'budget')

     if (hasTimeline && hasBudget) return 'high'
     if (hasTimeline || hasBudget) return 'medium'
     return 'low'
   }
   ```

### Task 4: Add Virtual Scrolling (Optional - Performance) (0.5 days)

1. **Install react-window for virtual scrolling**
   ```bash
   npm install react-window
   npm install -D @types/react-window
   ```

2. **Update Timeline to use virtual scrolling (if needed)**
   ```typescript
   // Only implement if >200 decisions in testing
   // For MVP, standard rendering is fine for <200 decisions
   import { FixedSizeList } from 'react-window'

   // Implement if performance testing shows >2s load time
   ```

### Task 5: Write Tests (0.75 days)

1. **Create `tests/components/Timeline.test.tsx`**
   ```typescript
   import { describe, it, expect, vi } from 'vitest'
   import { render, screen, waitFor } from '@testing-library/react'
   import { BrowserRouter, Routes, Route } from 'react-router-dom'
   import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
   import { Timeline } from '../../src/components/Timeline'
   import { api } from '../../src/services/api'

   vi.mock('../../src/services/api')

   const queryClient = new QueryClient({
     defaultOptions: { queries: { retry: false } },
   })

   const wrapper = ({ children }: { children: React.ReactNode }) => (
     <QueryClientProvider client={queryClient}>
       <BrowserRouter>
         <Routes>
           <Route path="/projects/:id" element={children} />
         </Routes>
       </BrowserRouter>
     </QueryClientProvider>
   )

   describe('Timeline', () => {
     it('displays decisions grouped by meeting', async () => {
       const mockDecisions = {
         decisions: [
           {
             id: '1',
             decision_statement: 'Changed material from concrete to steel',
             who: 'Carlos',
             timestamp: '00:23:15',
             discipline: 'structural',
             meeting_type: 'client',
             meeting_date: '2026-02-01T14:00:00Z',
             why: 'Client requirement',
             causation: 'client',
             impacts: [{ type: 'timeline', change: '+2 weeks' }],
             consensus: { architecture: 'AGREE', mep: 'AGREE' },
             confidence: 0.92,
             anomaly_flags: [],
             created_at: '2026-02-01T14:45:00Z',
           },
         ],
         total: 1,
         limit: 50,
         offset: 0,
       }

       vi.mocked(api.getDecisions).mockResolvedValue(mockDecisions)

       render(<Timeline />, { wrapper })

       await waitFor(() => {
         expect(screen.getByText('Changed material from concrete to steel')).toBeInTheDocument()
         expect(screen.getByText(/carlos/i)).toBeInTheDocument()
         expect(screen.getByText('structural')).toBeInTheDocument()
       })
     })

     it('displays empty state when no decisions', async () => {
       vi.mocked(api.getDecisions).mockResolvedValue({
         decisions: [],
         total: 0,
         limit: 50,
         offset: 0,
       })

       render(<Timeline />, { wrapper })

       await waitFor(() => {
         expect(screen.getByText(/no decisions yet/i)).toBeInTheDocument()
       })
     })
   })
   ```

---

## Dev Notes

### Timeline Architecture (Atomic Design)

```
Timeline (Organism)
├── Fetch decisions from API (React Query)
├── Group by meeting_date
├── Loading State → TimelineSkeleton (3 meeting groups)
├── Empty State → EmptyTimeline (icon + message)
├── Error State → Alert (Shadcn/ui) + Retry Button
└── For each meeting:
    ├── MeetingGroup (Molecule)
    │   ├── Meeting Header (date, type badge, count)
    │   │   ├── Calendar icon (lucide-react)
    │   │   ├── Meeting type Badge (Shadcn/ui)
    │   │   └── Decision count
    │   └── Decision Cards Container
    │       └── DecisionCard (Molecule) [repeating]
    │           ├── Discipline Badge (Shadcn/ui, Tailwind discipline-* colors)
    │           ├── Decision Statement (CardTitle)
    │           ├── Metadata (who, timestamp)
    │           ├── Badges Row:
    │           │   ├── Consensus Badge (Tailwind consensus-* colors)
    │           │   ├── Impact Badge (Tailwind impact-* colors)
    │           │   ├── Confidence Badge (outline variant)
    │           │   └── Anomaly Flags Badge (destructive variant)
    │           └── ChevronRight icon (indicates clickable)
    └── DrillDownModal (Organism, Story 3.7) - Triggered on card click
```

**Component File Locations:**
- `src/components/organisms/Timeline.tsx` - Main timeline organism
- `src/components/molecules/MeetingGroup.tsx` - Meeting header + cards
- `src/components/molecules/DecisionCard.tsx` - Individual decision card
- `src/components/atoms/` - Shadcn/ui (Card, Badge, Alert, Button)

### Performance Considerations

- **Target**: <2 second load for 200 decisions
- **Optimization**: Virtual scrolling if >200 decisions
- **Caching**: React Query stale time 5 minutes
- **Lazy loading**: Load decisions on scroll (pagination)

### Color Coding System (from UX Research + Story 3.1)

**Discipline Colors (Tailwind `discipline-*` classes):**
| Discipline | Color | Hex | Tailwind Class | Meaning |
|------------|-------|-----|----------------|---------|
| Architecture | Blue | #3B82F6 | `bg-discipline-architecture` | Design decisions |
| MEP | Orange | #F97316 | `bg-discipline-mep` | Mechanical/Electrical/Plumbing |
| Landscape | Green | #10B981 | `bg-discipline-landscape` | Landscape architecture |
| Structural | Purple | #8B5CF6 | `bg-discipline-structural` | Structural engineering |
| Electrical | Amber | #F59E0B | `bg-discipline-electrical` | Electrical systems |
| Plumbing | Cyan | #06B6D4 | `bg-discipline-plumbing` | Plumbing systems |

**Consensus Colors (Tailwind `consensus-*` classes):**
| Level | Color | Hex | Tailwind Class | Meaning |
|-------|-------|-----|----------------|---------|
| High (all AGREE) | Green | #10B981 | `bg-consensus-agree` | All stakeholders agree |
| Medium (some MIXED) | Amber | #F59E0B | `bg-consensus-mixed` | Most agree, some mixed |
| Low (DISSENT) | Red | #EF4444 | `bg-consensus-dissent` | Significant dissent |

**Impact Colors (Tailwind `impact-*` classes):**
| Level | Color | Hex | Tailwind Class | Meaning |
|-------|-------|-----|----------------|---------|
| High | Red 600 | #DC2626 | `bg-impact-high` | Major timeline/budget impact |
| Medium | Amber 500 | #F59E0B | `bg-impact-medium` | Moderate impact |
| Low | Gray 400 | #9CA3AF | `bg-impact-low` | Minor impact |

**Usage Notes:**
- All colors defined in `tailwind.config.ts` (Story 3.1)
- Use with opacity for backgrounds: `bg-discipline-architecture/10` (10% opacity)
- WCAG AA compliant contrast ratios (4.5:1 minimum)
- Color-blind friendly (distinct hues + labels + icons)

---

## File List

**Modified/Created (Atomic Design Structure):**
- `src/components/organisms/Timeline.tsx` (new) - Main timeline organism
- `src/components/molecules/MeetingGroup.tsx` (new) - Meeting header + decision cards
- `src/components/molecules/DecisionCard.tsx` (new) - Individual decision card molecule
- `src/lib/utils.ts` (modify) - Add helper functions (getDisciplineColor, getConsensusColor, getImpactColor) - already in Story 3.1
- `tests/components/Timeline.test.tsx` (new) - Timeline integration tests
- `tests/components/MeetingGroup.test.tsx` (new) - Meeting group tests
- `tests/components/DecisionCard.test.tsx` (new) - Decision card unit tests
- `package.json` (modify) - Verify lucide-react installed (icons), add react-window if needed (performance)

---

## Testing Strategy

### Unit Tests

```typescript
// Test coverage areas:
- ✅ Timeline rendering
- ✅ Decision grouping by meeting
- ✅ Meeting header display
- ✅ Decision card rendering
- ✅ Discipline color coding
- ✅ Consensus indicators
- ✅ Impact badges
- ✅ Empty state
- ✅ Loading state
- ✅ Error handling
```

### Performance Testing

```bash
# Test with 200+ decisions
npm run test:performance

# Measure load time
# Target: <2 seconds
```

### Coverage Target

- Minimum: 80%
- Target: 90%+
- Run: `npm run test -- --coverage`

---

## UX Design System References

**Primary Documentation:**
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - **Part 2: Insight 2 "Digest vs. Deep Dive Split"** (this is the "Deep Dive" view)
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - Part 2: Insight 3 "Discipline-First Mental Model"
- `docs/ux/REQUIREMENTS-TRANSLATION-GUIDE.md` - Story 3.5 example (Decision Timeline)
- `docs/ux/AIOS-WORKFLOW-INTEGRATION.md` - Component architecture patterns

**Key Sections:**
- User Persona 2 (Architects): `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Part 1
- Digest vs. Deep Dive: `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Insight 2
- Discipline-First: `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Insight 3
- Tailwind Color System: Story 3.1 → `tailwind.config.ts`
- Atomic Design: `REQUIREMENTS-TRANSLATION-GUIDE.md` → Part 3

**Shadcn/ui Components Used:**
- Card: https://ui.shadcn.com/docs/components/card
- Badge: https://ui.shadcn.com/docs/components/badge
- Alert: https://ui.shadcn.com/docs/components/alert
- Button: https://ui.shadcn.com/docs/components/button

**Design Rationale:**
- **Why timeline?** Architects need to see ALL decisions chronologically to understand project evolution
- **Why discipline colors?** Architects scan visually by discipline first ("Show me all MEP decisions")
- **Why consensus indicators?** Helps identify controversial decisions requiring follow-up
- **Why meeting grouping?** Provides context - decisions made in same meeting are related
- **Why clickable cards?** Enables drill-down for full transparency (Insight 1)

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-08 | Created story |
| 2026-02-08 | Updated with UX design system guidelines (Shadcn/ui, Atomic Design, Tailwind colors, mobile-first, WCAG AA) |

---

**Related Stories:** 3.1 (Frontend Setup), 3.4 (Projects List), 3.6 (Filters), 3.7 (Drill-down), 3.10 (Responsive Design)
**Blocked By:** 3.1 (Frontend Setup), 3.4 (Projects List selection)
**Blocks:** 3.6 (Filters need timeline to filter), 3.7 (Drill-down triggered from timeline)
