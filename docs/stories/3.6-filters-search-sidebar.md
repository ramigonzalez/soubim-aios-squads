# Story 3.6: Filters & Search Sidebar

**Story ID:** 3.6
**Assigned to:** @dev
**Sprint:** Sprint 5 (Week 7)
**Status:** Draft
**Estimation:** 8 story points (3-4 days)

---

## Summary

Create a comprehensive filters sidebar for decisions timeline with date range picker, multi-select filters for discipline/meeting type/impact/consensus, free-text search, and active filter indicators. All filters work together with <200ms update performance.

---

## UX Research Context

This story implements **critical filtering functionality** for Architects and directly supports:

**Research Insight 3: Discipline-First Mental Model ⭐ (Primary)**
- **Critical Finding:** Architects think in discipline silos first: *"Show me all MEP decisions that affect my architecture work"*
- Discipline filter must be **prominent and easy to access**
- Multi-select checkboxes allow filtering by multiple disciplines simultaneously
- Default state: All disciplines shown, Architects narrow by checking specific disciplines
- **This is how Architects naturally organize their mental model** of project decisions

**Research Insight 2: Digest vs. Deep Dive Split**
- Filters enable Architects to **narrow the Deep Dive** (Timeline, Story 3.5)
- Gabriela (Director) may use basic filters but relies more on Executive Digest (Story 3.8)
- Filters transform the timeline from "all 200+ decisions" to "12 MEP decisions from last 2 weeks"

**Research Insight 4: Mobile-First for Gabriela During Maternity**
- Filters must work on **iPad and mobile** (responsive design)
- **Desktop:** Fixed sidebar (320px width, left side of timeline)
- **Tablet/Mobile:** Drawer component (slide-in from left, overlay)
- Filter button (hamburger/filter icon) toggles drawer on mobile

**Research Insight 1: Trust Through Transparency**
- Filters don't hide decisions, they **focus attention** on relevant decisions
- "Clear all" button always visible to reset to full transparency
- Active filter count badge shows how many filters are applied

**Design System: Shadcn/ui Checkbox, Accordion, Input Components**
- Checkbox: Multi-select for disciplines, meeting types
- Accordion: Collapsible filter groups (Discipline, Meeting Type, Date Range, etc.)
- Input: Search text box (debounced 300ms), date pickers
- Badge: Active filter count indicator
- Button: "Clear all" filters

**Component Architecture: Atomic Design**
- **Organism:** FilterSidebar (complex feature with state management, multiple filter groups)
- **Molecules:** FilterSection (accordion item with checkboxes), SearchInput (with debounce)
- **Atoms:** Checkbox, Input, Label, Button, Badge, Accordion (from Shadcn/ui)

**User Flow:**
1. User lands on Project Detail page with Timeline (Story 3.5)
2. Sees all 200+ decisions → Overwhelming
3. Opens Filters sidebar (desktop: visible, mobile: drawer button)
4. Checks "MEP" + "Architecture" disciplines → Timeline narrows to ~50 decisions
5. Adds date range "Last 2 weeks" → Further narrows to ~12 decisions
6. Scans 12 decisions, clicks one for drill-down (Story 3.7)
7. **Result:** Faster decision discovery, reduced cognitive load

**Performance Requirements:**
- Filter update: <200ms from checkbox click to timeline refresh
- Debounced search: 300ms delay (prevents API spam while typing)
- URL persistence: Filters saved in query params (shareable links)

**Reference:** `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` (Part 2: Insight 3 "Discipline-First Mental Model")

---

## Acceptance Criteria

### Filter Sidebar Layout & Structure
- [ ] FilterSidebar component using Shadcn/ui components
- [ ] Shadcn/ui `Accordion` with collapsible filter sections:
  - [ ] "Discipline" section (default: expanded)
  - [ ] "Meeting Type" section (default: expanded)
  - [ ] "Date Range" section (default: collapsed)
  - [ ] "Anomalies" section (default: collapsed)
- [ ] Sidebar header with:
  - [ ] Filter icon (lucide-react `Filter`)
  - [ ] "Filters" heading (text-lg font-semibold)
  - [ ] Active filter count badge (Shadcn/ui `Badge`, variant=secondary)
  - [ ] "Clear all" button (Shadcn/ui `Button`, variant=ghost, only visible if filters active)

### Discipline Filter (UX Insight 3: Primary Filter)
- [ ] **Prominent placement:** First filter section, expanded by default
- [ ] Multi-select checkboxes (Shadcn/ui `Checkbox`) for:
  - [ ] Architecture
  - [ ] MEP
  - [ ] Landscape
  - [ ] Structural
  - [ ] Electrical
  - [ ] Plumbing
  - [ ] General (catch-all)
- [ ] Discipline checkboxes with Labels (Shadcn/ui `Label`, cursor-pointer)
- [ ] Visual indication of selected disciplines (checkbox checked state)
- [ ] Clicking checkbox toggles discipline filter immediately

### Meeting Type Filter
- [ ] Multi-select checkboxes for:
  - [ ] Client
  - [ ] Multi-disciplinary
  - [ ] Internal
- [ ] Same checkbox/label pattern as Discipline filter
- [ ] Expanded by default (secondary filter after Discipline)

### Date Range Filter
- [ ] Two date input fields (HTML5 `type="date"` with Shadcn/ui `Input` styling):
  - [ ] "From" date picker
  - [ ] "To" date picker
- [ ] Labels for each date field
- [ ] Date inputs use native browser date picker on mobile
- [ ] Validation: "To" date must be >= "From" date (optional Phase 2)
- [ ] Collapsed by default (less commonly used filter)

### Search Input (Debounced)
- [ ] Free-text search input (Shadcn/ui `Input` component)
- [ ] Placeholder: "Search decisions..."
- [ ] Searches across:
  - [ ] Decision statement field
  - [ ] Why/reasoning field
- [ ] **300ms debounce** to prevent API spam while typing
- [ ] Search input visible at top of sidebar (always accessible)
- [ ] Clear icon in search input when text present (optional Phase 2)

### Anomalies Filter
- [ ] Single checkbox: "Show only flagged decisions"
- [ ] Filters decisions with `anomaly_flags.length > 0`
- [ ] Collapsed by default (specialized filter)

### Combined Filtering & State Management
- [ ] All filters work together (AND logic):
  - Example: Discipline=MEP AND Meeting_Type=Client AND Date_From=2026-01-01
- [ ] Zustand store (`filterStore.ts`) manages filter state:
  - [ ] `filters` object with all filter values
  - [ ] `setFilter(key, value)` updates individual filter
  - [ ] `clearFilters()` resets all filters to default
  - [ ] `activeCount()` returns number of active filters
- [ ] Timeline (Story 3.5) subscribes to filter store
- [ ] React Query refetches decisions when filters change (queryKey includes filters)

### Active Filter Indicators
- [ ] Badge showing active filter count (e.g., "3" if 3 filters active)
- [ ] Badge only visible if `activeCount() > 0`
- [ ] Badge positioned next to "Filters" heading
- [ ] "Clear all" button only visible if filters active

### Clear All Filters
- [ ] Button labeled "Clear" with X icon (lucide-react `X`)
- [ ] Positioned in sidebar header (right side)
- [ ] Resets all filters to default state (empty arrays, undefined values)
- [ ] Timeline refreshes to show all decisions after clear

### URL Persistence (Shareable Filters)
- [ ] Filters synced to URL query parameters:
  - `?discipline=mep,architecture&date_from=2026-01-01&search=foundation`
- [ ] On page load, filters read from URL and applied
- [ ] When filters change, URL updates (replace: true, no history spam)
- [ ] Shareable links preserve filter state (user can share filtered view)

### Performance (UX Success Metric)
- [ ] Filter update: <200ms from checkbox click to timeline refresh
- [ ] Search input debounced: 300ms delay before API call
- [ ] No blocking UI during filter updates (optimistic updates)
- [ ] React Query caching: Filtered results cached separately

### Responsive Design (UX Insight 4: Mobile-First)
- [ ] **Desktop (1024px+):**
  - Fixed sidebar (320px width, border-right, left of timeline)
  - Sidebar always visible
  - Scroll sidebar content if overflows
- [ ] **Tablet/Mobile (< 1024px):**
  - Sidebar hidden by default
  - Filter button visible (top-left, hamburger/filter icon)
  - Click filter button → Drawer slides in from left
  - Drawer overlay (dark background, click to close)
  - Shadcn/ui Sheet/Drawer component (if available) or custom drawer
  - Drawer closeable via X button or backdrop click
- [ ] Touch-friendly filter controls (checkbox tap area ≥44px)

### Accessibility (WCAG 2.1 AA)
- [ ] Semantic HTML:
  - `<aside>` for sidebar container
  - `<form>` or proper form structure (optional)
  - Labels associated with inputs (`htmlFor` attribute)
- [ ] ARIA labels:
  - Filter button: `aria-label="Open filters"`
  - Accordion sections: ARIA expanded state (Shadcn/ui default)
  - Checkboxes: Associated labels (Shadcn/ui `Label` component)
- [ ] Keyboard navigation:
  - Tab through all filter controls
  - Space/Enter to toggle checkboxes
  - Arrow keys in accordion (Shadcn/ui default)
- [ ] Focus visible styles (Shadcn/ui default focus ring)
- [ ] Screen reader friendly:
  - Active filter count announced
  - "Clear all" button announces action

### Testing
- [ ] Unit tests >80% coverage:
  - Filter sidebar renders
  - Discipline checkboxes toggle correctly
  - Meeting type checkboxes toggle correctly
  - Date range inputs update filter state
  - Search input updates filter (debounced)
  - "Clear all" resets filters
  - Active count calculated correctly
  - URL persistence (query params sync)
- [ ] Integration test: Filter changes → Timeline refetches → Decisions filtered
- [ ] Performance test: Filter update <200ms
- [ ] Responsive test: Drawer on mobile, sidebar on desktop
- [ ] Accessibility test: Keyboard navigation, screen reader

---

## Tasks

### Task 1: Create Filter Store (0.5 days)

1. **Create `src/store/filterStore.ts`**
   ```typescript
   import { create } from 'zustand'
   import { DecisionFilters } from '../types/api'

   interface FilterState {
     filters: DecisionFilters
     setFilter: <K extends keyof DecisionFilters>(key: K, value: DecisionFilters[K]) => void
     clearFilters: () => void
     activeCount: () => number
   }

   const DEFAULT_FILTERS: DecisionFilters = {
     discipline: [],
     meeting_type: [],
     date_from: undefined,
     date_to: undefined,
     confidence_min: undefined,
     has_anomalies: undefined,
     search: '',
   }

   export const useFilterStore = create<FilterState>((set, get) => ({
     filters: DEFAULT_FILTERS,

     setFilter: (key, value) => {
       set((state) => ({
         filters: { ...state.filters, [key]: value },
       }))
     },

     clearFilters: () => set({ filters: DEFAULT_FILTERS }),

     activeCount: () => {
       const { filters } = get()
       let count = 0
       if (filters.discipline && filters.discipline.length > 0) count++
       if (filters.meeting_type && filters.meeting_type.length > 0) count++
       if (filters.date_from) count++
       if (filters.date_to) count++
       if (filters.search) count++
       if (filters.has_anomalies !== undefined) count++
       return count
     },
   }))
   ```

### Task 2: Create Filter Sidebar Component (1.5 days)

1. **Create `src/components/FilterSidebar.tsx`**
   ```typescript
   import { useFilterStore } from '../store/filterStore'
   import { Button } from './ui/button'
   import { Input } from './ui/input'
   import { Label } from './ui/label'
   import { Checkbox } from './ui/checkbox'
   import { Badge } from './ui/badge'
   import {
     Accordion,
     AccordionContent,
     AccordionItem,
     AccordionTrigger,
   } from './ui/accordion'
   import { Filter, X } from 'lucide-react'

   const DISCIPLINES = [
     { value: 'architecture', label: 'Architecture' },
     { value: 'mep', label: 'MEP' },
     { value: 'landscape', label: 'Landscape' },
     { value: 'structural', label: 'Structural' },
     { value: 'electrical', label: 'Electrical' },
     { value: 'plumbing', label: 'Plumbing' },
     { value: 'general', label: 'General' },
   ]

   const MEETING_TYPES = [
     { value: 'client', label: 'Client' },
     { value: 'multi-disciplinary', label: 'Multi-disciplinary' },
     { value: 'internal', label: 'Internal' },
   ]

   export function FilterSidebar() {
     const { filters, setFilter, clearFilters, activeCount } = useFilterStore()

     const handleDisciplineToggle = (discipline: string) => {
       const current = filters.discipline || []
       const updated = current.includes(discipline)
         ? current.filter((d) => d !== discipline)
         : [...current, discipline]
       setFilter('discipline', updated)
     }

     const handleMeetingTypeToggle = (type: string) => {
       const current = filters.meeting_type || []
       const updated = current.includes(type)
         ? current.filter((t) => t !== type)
         : [...current, type]
       setFilter('meeting_type', updated)
     }

     return (
       <aside className="w-80 bg-white border-r border-gray-200 p-6 overflow-y-auto">
         <div className="flex items-center justify-between mb-6">
           <div className="flex items-center gap-2">
             <Filter className="h-5 w-5" />
             <h2 className="text-lg font-semibold">Filters</h2>
             {activeCount() > 0 && (
               <Badge variant="secondary">{activeCount()}</Badge>
             )}
           </div>

           {activeCount() > 0 && (
             <Button
               variant="ghost"
               size="sm"
               onClick={clearFilters}
               className="text-gray-600 hover:text-gray-900"
             >
               <X className="h-4 w-4 mr-1" />
               Clear
             </Button>
           )}
         </div>

         <div className="space-y-6">
           {/* Search */}
           <div>
             <Label htmlFor="search">Search</Label>
             <Input
               id="search"
               type="text"
               placeholder="Search decisions..."
               value={filters.search || ''}
               onChange={(e) => setFilter('search', e.target.value)}
               className="mt-2"
             />
           </div>

           {/* Accordion for filter groups */}
           <Accordion type="multiple" defaultValue={['discipline', 'meeting_type']}>
             {/* Discipline Filter */}
             <AccordionItem value="discipline">
               <AccordionTrigger>Discipline</AccordionTrigger>
               <AccordionContent>
                 <div className="space-y-2">
                   {DISCIPLINES.map((discipline) => (
                     <div key={discipline.value} className="flex items-center">
                       <Checkbox
                         id={`discipline-${discipline.value}`}
                         checked={filters.discipline?.includes(discipline.value)}
                         onCheckedChange={() => handleDisciplineToggle(discipline.value)}
                       />
                       <Label
                         htmlFor={`discipline-${discipline.value}`}
                         className="ml-2 text-sm cursor-pointer"
                       >
                         {discipline.label}
                       </Label>
                     </div>
                   ))}
                 </div>
               </AccordionContent>
             </AccordionItem>

             {/* Meeting Type Filter */}
             <AccordionItem value="meeting_type">
               <AccordionTrigger>Meeting Type</AccordionTrigger>
               <AccordionContent>
                 <div className="space-y-2">
                   {MEETING_TYPES.map((type) => (
                     <div key={type.value} className="flex items-center">
                       <Checkbox
                         id={`meeting-${type.value}`}
                         checked={filters.meeting_type?.includes(type.value)}
                         onCheckedChange={() => handleMeetingTypeToggle(type.value)}
                       />
                       <Label
                         htmlFor={`meeting-${type.value}`}
                         className="ml-2 text-sm cursor-pointer"
                       >
                         {type.label}
                       </Label>
                     </div>
                   ))}
                 </div>
               </AccordionContent>
             </AccordionItem>

             {/* Date Range Filter */}
             <AccordionItem value="date_range">
               <AccordionTrigger>Date Range</AccordionTrigger>
               <AccordionContent>
                 <div className="space-y-3">
                   <div>
                     <Label htmlFor="date_from">From</Label>
                     <Input
                       id="date_from"
                       type="date"
                       value={filters.date_from || ''}
                       onChange={(e) => setFilter('date_from', e.target.value)}
                       className="mt-1"
                     />
                   </div>
                   <div>
                     <Label htmlFor="date_to">To</Label>
                     <Input
                       id="date_to"
                       type="date"
                       value={filters.date_to || ''}
                       onChange={(e) => setFilter('date_to', e.target.value)}
                       className="mt-1"
                     />
                   </div>
                 </div>
               </AccordionContent>
             </AccordionItem>

             {/* Anomalies Filter */}
             <AccordionItem value="anomalies">
               <AccordionTrigger>Anomalies</AccordionTrigger>
               <AccordionContent>
                 <div className="flex items-center">
                   <Checkbox
                     id="has_anomalies"
                     checked={filters.has_anomalies === true}
                     onCheckedChange={(checked) =>
                       setFilter('has_anomalies', checked ? true : undefined)
                     }
                   />
                   <Label htmlFor="has_anomalies" className="ml-2 text-sm cursor-pointer">
                     Show only flagged decisions
                   </Label>
                 </div>
               </AccordionContent>
             </AccordionItem>
           </Accordion>
         </div>
       </aside>
     )
   }
   ```

2. **Install Shadcn components**
   ```bash
   npx shadcn-ui@latest add checkbox
   npx shadcn-ui@latest add accordion
   ```

### Task 3: Connect Filters to Timeline (1 day)

1. **Update Timeline to use filters**
   ```typescript
   // src/components/Timeline.tsx
   import { useFilterStore } from '../store/filterStore'

   export function Timeline() {
     const { id: projectId } = useParams<{ id: string }>()
     const filters = useFilterStore((state) => state.filters)

     const {
       data: decisionsData,
       isLoading,
       isError,
       error,
       refetch
     } = useQuery({
       queryKey: ['decisions', projectId, filters],
       queryFn: () => api.getDecisions(projectId!, filters),
       enabled: !!projectId,
     })

     // ... rest of component
   }
   ```

2. **Add debouncing for search input**
   ```typescript
   import { useDebouncedValue } from '../hooks/useDebouncedValue'

   // In FilterSidebar:
   const debouncedSearch = useDebouncedValue(filters.search, 300)

   useEffect(() => {
     setFilter('search', debouncedSearch)
   }, [debouncedSearch])
   ```

3. **Create `src/hooks/useDebouncedValue.ts`**
   ```typescript
   import { useEffect, useState } from 'react'

   export function useDebouncedValue<T>(value: T, delay: number): T {
     const [debouncedValue, setDebouncedValue] = useState<T>(value)

     useEffect(() => {
       const handler = setTimeout(() => {
         setDebouncedValue(value)
       }, delay)

       return () => {
         clearTimeout(handler)
       }
     }, [value, delay])

     return debouncedValue
   }
   ```

### Task 4: Add URL Persistence (0.5 days)

1. **Sync filters with URL query params**
   ```typescript
   // src/hooks/useFilterSync.ts
   import { useEffect } from 'react'
   import { useSearchParams } from 'react-router-dom'
   import { useFilterStore } from '../store/filterStore'

   export function useFilterSync() {
     const [searchParams, setSearchParams] = useSearchParams()
     const { filters, setFilter } = useFilterStore()

     // Load filters from URL on mount
     useEffect(() => {
       const discipline = searchParams.get('discipline')?.split(',')
       const meeting_type = searchParams.get('meeting_type')?.split(',')
       const date_from = searchParams.get('date_from')
       const date_to = searchParams.get('date_to')
       const search = searchParams.get('search')

       if (discipline) setFilter('discipline', discipline)
       if (meeting_type) setFilter('meeting_type', meeting_type)
       if (date_from) setFilter('date_from', date_from)
       if (date_to) setFilter('date_to', date_to)
       if (search) setFilter('search', search)
     }, [])

     // Update URL when filters change
     useEffect(() => {
       const params = new URLSearchParams()

       if (filters.discipline?.length) {
         params.set('discipline', filters.discipline.join(','))
       }
       if (filters.meeting_type?.length) {
         params.set('meeting_type', filters.meeting_type.join(','))
       }
       if (filters.date_from) params.set('date_from', filters.date_from)
       if (filters.date_to) params.set('date_to', filters.date_to)
       if (filters.search) params.set('search', filters.search)

       setSearchParams(params, { replace: true })
     }, [filters])
   }
   ```

### Task 5: Write Tests (0.5 days)

1. **Create `tests/components/FilterSidebar.test.tsx`**
   ```typescript
   import { describe, it, expect } from 'vitest'
   import { render, screen, fireEvent } from '@testing-library/react'
   import { FilterSidebar } from '../../src/components/FilterSidebar'
   import { useFilterStore } from '../../src/store/filterStore'

   describe('FilterSidebar', () => {
     beforeEach(() => {
       useFilterStore.getState().clearFilters()
     })

     it('renders all filter sections', () => {
       render(<FilterSidebar />)

       expect(screen.getByText('Filters')).toBeInTheDocument()
       expect(screen.getByLabelText('Search')).toBeInTheDocument()
       expect(screen.getByText('Discipline')).toBeInTheDocument()
       expect(screen.getByText('Meeting Type')).toBeInTheDocument()
       expect(screen.getByText('Date Range')).toBeInTheDocument()
     })

     it('toggles discipline filter', () => {
       render(<FilterSidebar />)

       const architectureCheckbox = screen.getByLabelText('Architecture')
       fireEvent.click(architectureCheckbox)

       const { filters } = useFilterStore.getState()
       expect(filters.discipline).toContain('architecture')
     })

     it('updates search filter', () => {
       render(<FilterSidebar />)

       const searchInput = screen.getByLabelText('Search')
       fireEvent.change(searchInput, { target: { value: 'foundation' } })

       const { filters } = useFilterStore.getState()
       expect(filters.search).toBe('foundation')
     })

     it('clears all filters', () => {
       const { setFilter } = useFilterStore.getState()
       setFilter('discipline', ['architecture'])
       setFilter('search', 'test')

       render(<FilterSidebar />)

       const clearButton = screen.getByText('Clear')
       fireEvent.click(clearButton)

       const { filters, activeCount } = useFilterStore.getState()
       expect(activeCount()).toBe(0)
       expect(filters.discipline).toEqual([])
       expect(filters.search).toBe('')
     })

     it('shows active filter count', () => {
       const { setFilter } = useFilterStore.getState()
       setFilter('discipline', ['architecture', 'mep'])

       render(<FilterSidebar />)

       expect(screen.getByText('2')).toBeInTheDocument()
     })
   })
   ```

---

## Dev Notes

### Filter Architecture (Atomic Design)

```
FilterSidebar (Organism)
├── Sidebar Header
│   ├── Filter icon + "Filters" heading
│   ├── Active Filter Count Badge (Shadcn/ui Badge)
│   └── "Clear all" Button (Shadcn/ui Button)
│
├── Search Input (Molecule)
│   ├── Label (Shadcn/ui)
│   ├── Input (Shadcn/ui, debounced 300ms)
│   └── useDebouncedValue hook
│
├── Accordion (Shadcn/ui)
│   ├── Discipline Filter Section (Molecule)
│   │   ├── AccordionTrigger: "Discipline"
│   │   └── AccordionContent
│   │       └── Checkbox Group (7 disciplines)
│   │           ├── Checkbox (Shadcn/ui Atom)
│   │           └── Label (Shadcn/ui Atom)
│   │
│   ├── Meeting Type Filter Section (Molecule)
│   │   ├── AccordionTrigger: "Meeting Type"
│   │   └── AccordionContent
│   │       └── Checkbox Group (3 types)
│   │
│   ├── Date Range Filter Section (Molecule)
│   │   ├── AccordionTrigger: "Date Range"
│   │   └── AccordionContent
│   │       ├── "From" Date Input (Atom)
│   │       └── "To" Date Input (Atom)
│   │
│   └── Anomalies Filter Section (Molecule)
│       ├── AccordionTrigger: "Anomalies"
│       └── AccordionContent
│           └── Single Checkbox: "Show only flagged"
│
└── FilterStore (Zustand State)
    ├── filters: { discipline[], meeting_type[], date_from, date_to, search, has_anomalies }
    ├── setFilter(key, value)
    ├── clearFilters()
    └── activeCount()

Timeline (Story 3.5) - Consumer
└── useQuery(['decisions', projectId, filters])
    ├── Subscribes to filters from Zustand
    ├── Refetches when filters change
    └── Displays filtered decisions

useFilterSync Hook
├── Reads filters from URL on mount
└── Updates URL when filters change
```

**Component File Locations:**
- `src/components/organisms/FilterSidebar.tsx` - Main filter sidebar organism
- `src/store/filterStore.ts` - Zustand filter state management
- `src/hooks/useDebouncedValue.ts` - Debounce hook for search input
- `src/hooks/useFilterSync.ts` - URL query param sync hook
- `src/components/atoms/` - Shadcn/ui (Checkbox, Input, Label, Button, Badge, Accordion)

### Performance Optimization

- **Debounced search**: 300ms delay prevents API spam
- **React Query cache**: Filters changes cached separately
- **Target**: <200ms filter update
- **URL sync**: Filters preserved in query params (shareable)

---

## File List

**Modified/Created (Atomic Design Structure):**
- `src/components/organisms/FilterSidebar.tsx` (new) - Filter sidebar organism
- `src/store/filterStore.ts` (new) - Zustand filter state management
- `src/hooks/useDebouncedValue.ts` (new) - Debounce hook (300ms delay)
- `src/hooks/useFilterSync.ts` (new) - URL query param synchronization
- `src/components/organisms/Timeline.tsx` (modify) - Subscribe to filter store, pass filters to React Query
- `src/types/api.ts` (modify) - Add DecisionFilters interface if not exists
- `tests/store/filterStore.test.ts` (new) - Zustand store tests
- `tests/components/FilterSidebar.test.tsx` (new) - Filter sidebar component tests
- `tests/hooks/useDebouncedValue.test.ts` (new) - Debounce hook tests
- `tests/hooks/useFilterSync.test.ts` (new) - URL sync hook tests
- `package.json` (verify) - Ensure Shadcn/ui checkbox, accordion installed

---

## Testing Strategy

### Unit Tests

```typescript
// Test coverage areas:
- ✅ Filter sidebar rendering
- ✅ Discipline filter toggle
- ✅ Meeting type filter toggle
- ✅ Date range selection
- ✅ Search input update
- ✅ Clear filters button
- ✅ Active filter count
- ✅ URL persistence
- ✅ Debounced search
```

### Performance Testing

```bash
# Measure filter update time
# Target: <200ms from filter change to UI update
```

### Coverage Target

- Minimum: 80%
- Target: 90%+
- Run: `npm run test -- --coverage`

---

## UX Design System References

**Primary Documentation:**
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - **Part 2: Insight 3 "Discipline-First Mental Model"** (PRIMARY)
- `docs/ux/RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` - Part 2: Insight 2 "Digest vs. Deep Dive Split"
- `docs/ux/REQUIREMENTS-TRANSLATION-GUIDE.md` - Story 3.6 example (Filters Sidebar)
- `docs/ux/AIOS-WORKFLOW-INTEGRATION.md` - Component architecture patterns

**Key Sections:**
- User Persona 2 (Architects): `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Part 1
- Discipline-First Mental Model: `RESEARCH-AND-DESIGN-SYSTEM-ANALYSIS.md` → Insight 3
- Atomic Design: `REQUIREMENTS-TRANSLATION-GUIDE.md` → Part 3
- Responsive Drawer Pattern: Story 3.10 (Responsive Design)

**Shadcn/ui Components Used:**
- Checkbox: https://ui.shadcn.com/docs/components/checkbox
- Accordion: https://ui.shadcn.com/docs/components/accordion
- Input: https://ui.shadcn.com/docs/components/input
- Label: https://ui.shadcn.com/docs/components/label
- Badge: https://ui.shadcn.com/docs/components/badge
- Button: https://ui.shadcn.com/docs/components/button
- Sheet/Drawer: https://ui.shadcn.com/docs/components/sheet (for mobile drawer)

**Design Rationale:**
- **Why Discipline filter first?** Architects' primary mental model is discipline-based organization (UX Insight 3)
- **Why multi-select checkboxes?** Architects often need to see multiple disciplines at once (e.g., "MEP + Architecture")
- **Why debounced search?** Prevents API spam, improves performance, better UX for fast typers
- **Why URL persistence?** Shareable filtered views, enables collaboration ("Check this filtered timeline link")
- **Why drawer on mobile?** Saves screen space for timeline on small screens, touch-friendly pattern
- **Why Accordion?** Collapses less-used filters (Date Range, Anomalies), focuses on primary filters (Discipline, Meeting Type)

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-08 | Created story |
| 2026-02-08 | Updated with UX design system guidelines (Shadcn/ui Checkbox/Accordion, Atomic Design, Discipline-First, mobile drawer, WCAG AA) |

---

**Related Stories:** 3.1 (Frontend Setup), 3.5 (Timeline), 3.9 (API Endpoints), 3.10 (Responsive Design)
**Blocked By:** 3.1 (Frontend Setup), 3.5 (Timeline component must exist to filter)
**Blocks:** None (enhances Timeline usability)
