# Story 7.2: Frontend — Ingestion Approval Page

**Story ID:** 7.2
**Epic:** E7 — Multi-Source Ingestion Pipeline
**Assigned to:** @dev
**Sprint:** Sprint 3 (Week 4)
**Status:** Complete
**Estimation:** 8 story points (3 days)
**Review:** @ux-design-expert (Uma)
**UX Guidelines:** `docs/ux/UX-UI-GUIDELINES.md`

---

## Summary

Build the `/ingestion` route and `IngestionApproval` organism that lets admin users review, approve, or reject incoming source materials (meeting recordings, emails, documents) before they enter the processing pipeline. The page displays tabbed or unified source rows with per-row Include toggles, AI summaries, bulk action controls, filters, and status indicators. Only admin users can access this page; all others are redirected. A real-time pending-count badge appears in the navigation.

---

## Acceptance Criteria

### Routing & Access Control
- [x] `/ingestion` route is registered in the router
- [x] Route renders the `IngestionApproval` organism wrapped in the `Ingestion` page component
- [x] Non-admin users are redirected away from `/ingestion` (role check against auth store)
- [x] Navigation link to `/ingestion` is only visible to admin users (Story 9.5)

### Meeting Source Rows
- [x] Each meeting row displays: Call ID, Project, Date/Time, Meeting Type, Source, Include toggle, AI Summary (collapsed), Transcript link
- [x] Transcript link opens in a new tab
- [x] AI Summary expands/collapses inline on click (no modal)

### Email Source Rows
- [x] Each email row displays: Email ID, Project, Date, Subject, From, To/CC count, Include toggle, AI Summary (collapsed), Thread link
- [x] Thread link opens in a new tab
- [x] To/CC count shown as a numeric badge (e.g. "3 recipients")
- [x] AI Summary expands/collapses inline on click

### Document Source Rows
- [x] Each document row displays: Document ID, Project, Upload Date, File Name, File Type, File Size, Include toggle, AI Summary (collapsed), File link
- [x] File size displayed in human-readable format (e.g. "2.4 MB")
- [x] File link opens/downloads in a new tab
- [x] AI Summary expands/collapses inline on click

### Include Toggle
- [x] Each row has an Include toggle (checkbox or switch) that immediately calls `PATCH /api/ingestion/{source_id}` to approve or reject
- [x] Toggle reflects the current status (checked = approved, unchecked = rejected, indeterminate = pending)
- [x] Optimistic update: toggle changes immediately; reverts on API error with toast notification

### Bulk Actions
- [x] Checkbox on each row selects it (stored in Zustand ingestion store)
- [x] "Select All" checkbox in header row selects/deselects all visible rows
- [x] Bulk action bar appears when one or more rows are selected
- [x] "Approve Selected" button calls `POST /api/ingestion/batch` with `{source_ids: [...], action: 'approve'}`
- [x] "Reject Selected" button calls `POST /api/ingestion/batch` with `{source_ids: [...], action: 'reject'}`
- [x] Bulk action bar shows count of selected items ("3 items selected")
- [x] After bulk action completes, selection is cleared and row list refetches

### Filters
- [x] Filter by project: dropdown/select populated from available projects
- [x] Filter by source type: chips for "All", "Meeting", "Email", "Document"
- [x] Filter by date range: two date inputs (from / to)
- [x] Active filters shown as removable chips below the filter bar
- [x] "Clear All Filters" button resets all filters
- [x] Filters are applied client-side against the fetched source list (no additional API call per filter change)

### Status Indicators
- [x] Pending status: yellow badge (`bg-yellow-100 text-yellow-800`)
- [x] Approved status: green badge (`bg-green-100 text-green-800`)
- [x] Rejected status: red badge (`bg-red-100 text-red-800`)
- [x] Processed status: blue badge (`bg-blue-100 text-blue-800`)
- [x] Status badge displayed on every row

### Navigation Badge
- [x] Navigation item for "Ingestion" shows a count badge with the number of pending items
- [x] Badge fetches count from `GET /api/ingestion?status=pending&count_only=true` (or derives from cached list)
- [x] Badge updates when items are approved/rejected (React Query cache invalidation)
- [x] Badge hidden when pending count is 0

### Loading, Empty, and Error States
- [x] Loading state: skeleton rows with `animate-pulse` (3 rows per source type)
- [x] Empty state when no pending sources: icon + "No pending items" heading + description
- [x] Error state: error message with "Retry" button that triggers React Query refetch

### Responsive Design
- [x] Mobile (375px): horizontally scrollable table or stacked card layout per row
- [x] Tablet (768px): full table layout with overflow-x-auto wrapper
- [x] Desktop (1024px+): full table, max-w-7xl container

### Accessibility
- [x] Table uses `<table>`, `<thead>`, `<tbody>`, `<th scope="col">`, `<td>` semantic elements
- [x] Include toggles have associated labels with `aria-label="Include {source_id}"`
- [x] Status badges have `aria-label="Status: {status}"`
- [x] Bulk action bar is announced via `aria-live="polite"` when it appears/disappears
- [x] Keyboard navigation through rows: Tab, Space to toggle checkboxes, Enter to expand AI summary

---

## Tasks

### Task 1: Define TypeScript Interfaces and API Service (0.25 days)

1. **Update `src/types/ingestion.ts`** (new file)

   ```typescript
   export type SourceType = 'meeting' | 'email' | 'document'
   export type IngestionStatus = 'pending' | 'approved' | 'rejected' | 'processed'

   export interface BaseSource {
     id: string
     project_id: string
     project_name: string
     source_type: SourceType
     status: IngestionStatus
     ai_summary: string | null
     included: boolean
     created_at: string
   }

   export interface MeetingSource extends BaseSource {
     source_type: 'meeting'
     call_id: string
     meeting_date: string      // ISO datetime
     meeting_type: string      // e.g. "Design Review", "Site Visit"
     source_label: string      // e.g. "Fireflies", "Teams"
     transcript_url: string | null
   }

   export interface EmailSource extends BaseSource {
     source_type: 'email'
     email_id: string
     email_date: string        // ISO datetime
     subject: string
     from_address: string
     recipient_count: number   // To + CC total
     thread_url: string | null
   }

   export interface DocumentSource extends BaseSource {
     source_type: 'document'
     document_id: string
     upload_date: string       // ISO datetime
     file_name: string
     file_type: string         // e.g. "PDF", "DOCX"
     file_size_bytes: number
     file_url: string | null
   }

   export type Source = MeetingSource | EmailSource | DocumentSource

   export interface IngestionResponse {
     sources: Source[]
     total: number
     pending_count: number
   }

   export interface BatchActionPayload {
     source_ids: string[]
     action: 'approve' | 'reject'
   }

   export interface BatchActionResponse {
     updated: number
     failed: string[]
   }

   export interface IngestionFilters {
     project_id: string | null
     source_type: SourceType | null
     date_from: string | null   // ISO date string
     date_to: string | null
   }
   ```

2. **Update `src/services/ingestionService.ts`** (new file)

   ```typescript
   import apiClient from './apiClient'
   import type { IngestionResponse, BatchActionPayload, BatchActionResponse } from '../types/ingestion'

   export const ingestionService = {
     getSources: (): Promise<IngestionResponse> =>
       apiClient.get('/ingestion').then(r => r.data),

     updateSource: (sourceId: string, included: boolean): Promise<void> =>
       apiClient.patch(`/ingestion/${sourceId}`, { included }).then(r => r.data),

     batchAction: (payload: BatchActionPayload): Promise<BatchActionResponse> =>
       apiClient.post('/ingestion/batch', payload).then(r => r.data),
   }
   ```

### Task 2: Create Zustand Ingestion Store (0.25 days)

1. **Create `src/store/ingestionStore.ts`**

   ```typescript
   import { create } from 'zustand'
   import type { IngestionFilters, SourceType } from '../types/ingestion'

   interface IngestionStore {
     selectedIds: Set<string>
     filters: IngestionFilters
     toggleSelected: (id: string) => void
     selectAll: (ids: string[]) => void
     clearSelection: () => void
     setFilter: (key: keyof IngestionFilters, value: string | null) => void
     clearFilters: () => void
   }

   const defaultFilters: IngestionFilters = {
     project_id: null,
     source_type: null,
     date_from: null,
     date_to: null,
   }

   export const useIngestionStore = create<IngestionStore>((set) => ({
     selectedIds: new Set(),
     filters: defaultFilters,

     toggleSelected: (id) =>
       set((state) => {
         const next = new Set(state.selectedIds)
         next.has(id) ? next.delete(id) : next.add(id)
         return { selectedIds: next }
       }),

     selectAll: (ids) => set({ selectedIds: new Set(ids) }),
     clearSelection: () => set({ selectedIds: new Set() }),

     setFilter: (key, value) =>
       set((state) => ({ filters: { ...state.filters, [key]: value } })),

     clearFilters: () => set({ filters: defaultFilters }),
   }))
   ```

### Task 3: Create useIngestion and useIngestionMutation Hooks (0.25 days)

1. **Create `src/hooks/useIngestion.ts`**

   ```typescript
   import { useQuery } from '@tanstack/react-query'
   import { ingestionService } from '../services/ingestionService'
   import type { Source, IngestionFilters } from '../types/ingestion'

   export function useIngestion() {
     return useQuery({
       queryKey: ['ingestion'],
       queryFn: ingestionService.getSources,
       staleTime: 30_000, // 30 seconds — ingestion list changes frequently
     })
   }

   export function useFilteredSources(
     sources: Source[] | undefined,
     filters: IngestionFilters
   ): Source[] {
     if (!sources) return []
     return sources.filter((s) => {
       if (filters.project_id && s.project_id !== filters.project_id) return false
       if (filters.source_type && s.source_type !== filters.source_type) return false
       const sourceDate = getSourceDate(s)
       if (filters.date_from && sourceDate < filters.date_from) return false
       if (filters.date_to && sourceDate > filters.date_to) return false
       return true
     })
   }

   function getSourceDate(source: Source): string {
     switch (source.source_type) {
       case 'meeting': return source.meeting_date.split('T')[0]
       case 'email': return source.email_date.split('T')[0]
       case 'document': return source.upload_date.split('T')[0]
     }
   }
   ```

2. **Create `src/hooks/useIngestionMutation.ts`**

   ```typescript
   import { useMutation, useQueryClient } from '@tanstack/react-query'
   import { ingestionService } from '../services/ingestionService'
   import type { BatchActionPayload } from '../types/ingestion'

   export function useToggleInclude() {
     const queryClient = useQueryClient()
     return useMutation({
       mutationFn: ({ id, included }: { id: string; included: boolean }) =>
         ingestionService.updateSource(id, included),
       onSuccess: () => queryClient.invalidateQueries({ queryKey: ['ingestion'] }),
     })
   }

   export function useBatchAction() {
     const queryClient = useQueryClient()
     return useMutation({
       mutationFn: (payload: BatchActionPayload) =>
         ingestionService.batchAction(payload),
       onSuccess: () => queryClient.invalidateQueries({ queryKey: ['ingestion'] }),
     })
   }
   ```

### Task 4: Create SourceRow Molecules (0.5 days)

1. **Create `src/components/molecules/IngestionStatusBadge.tsx`**

   Status badge with consistent Tailwind classes per status:
   ```typescript
   const STATUS_CLASSES: Record<IngestionStatus, string> = {
     pending:   'bg-yellow-100 text-yellow-800',
     approved:  'bg-green-100 text-green-800',
     rejected:  'bg-red-100 text-red-800',
     processed: 'bg-blue-100 text-blue-800',
   }
   // Usage: <span className={cn('text-xs font-medium px-2 py-0.5 rounded-full', STATUS_CLASSES[status])} aria-label={`Status: ${status}`}>{status}</span>
   ```

2. **Create `src/components/molecules/AISummaryExpander.tsx`**

   Inline expand/collapse for AI summary text:
   - Props: `summary: string | null`
   - "No summary available" placeholder when null
   - Collapsed: first 80 chars + "... Show more" link
   - Expanded: full text + "Show less" link
   - Uses local `useState` for open/closed

3. **Create `src/components/molecules/MeetingSourceRow.tsx`**

   Table row `<tr>` for meeting sources. Columns: Select checkbox, Call ID, Project, Date/Time, Meeting Type, Source, Status badge, Include toggle, AI Summary expander, Transcript link.

4. **Create `src/components/molecules/EmailSourceRow.tsx`**

   Table row `<tr>` for email sources. Columns: Select checkbox, Email ID, Project, Date, Subject, From, Recipient count badge, Status badge, Include toggle, AI Summary expander, Thread link.

5. **Create `src/components/molecules/DocumentSourceRow.tsx`**

   Table row `<tr>` for document sources. Columns: Select checkbox, Document ID, Project, Upload Date, File Name, File Type, File Size (human-readable), Status badge, Include toggle, AI Summary expander, File link.

   ```typescript
   // File size formatting util — add to src/lib/utils.ts
   export function formatFileSize(bytes: number): string {
     if (bytes < 1024) return `${bytes} B`
     if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`
     return `${(bytes / (1024 * 1024)).toFixed(1)} MB`
   }
   ```

### Task 5: Create IngestionFiltersBar Molecule (0.25 days)

1. **Create `src/components/molecules/IngestionFiltersBar.tsx`**

   ```
   Filter layout:
   [ Project ▼ ] [ All | Meeting | Email | Document ] [ From date ] [ To date ] [ Clear All ]

   Active filter chips (below bar, only when filter active):
   [ Project: Soubim Tower ✕ ] [ Type: Email ✕ ]
   ```

   - Source type selector: four `<button>` chips with active state (`bg-blue-600 text-white` vs `bg-white text-gray-700 border border-gray-300`)
   - Project select: `<select>` populated from unique project names in the source list
   - Date inputs: native `<input type="date">` styled with Tailwind
   - Active chips: `bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full flex items-center gap-1` with an X button

### Task 6: Create BulkActionBar Organism (0.25 days)

1. **Create `src/components/organisms/BulkActionBar.tsx`**

   Sticky bar that appears at the bottom of the viewport when items are selected:

   ```
   Tailwind: fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg px-6 py-3 flex items-center justify-between z-30
   ```

   - Left: "{N} items selected" count
   - Right: "Reject Selected" (red outline button) + "Approve Selected" (green solid button)
   - "Approve Selected": `bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-sm font-medium`
   - "Reject Selected": `border border-red-300 text-red-700 px-4 py-2 rounded-md hover:bg-red-50 text-sm font-medium`
   - Bar uses `aria-live="polite"` to announce appearance to screen readers

### Task 7: Create IngestionApproval Organism (0.75 days)

1. **Create `src/components/organisms/IngestionApproval.tsx`**

   Main organism that composes all sub-components:

   ```
   IngestionApproval (Organism)
   ├── Page header: "Ingestion Approval" + pending count summary
   ├── IngestionFiltersBar (Molecule)
   ├── Active filter chips (conditional)
   ├── Source table
   │   ├── <table> with responsive overflow-x-auto wrapper
   │   ├── <thead> — Select All checkbox, column headers
   │   └── <tbody>
   │       ├── MeetingSourceRow (Molecule) [for each meeting source]
   │       ├── EmailSourceRow (Molecule) [for each email source]
   │       └── DocumentSourceRow (Molecule) [for each document source]
   ├── Empty state (when filteredSources.length === 0)
   ├── Error state with retry
   └── BulkActionBar (Organism, conditional on selectedIds.size > 0)
   ```

   - Fetches sources via `useIngestion()`
   - Applies filters via `useFilteredSources(sources, filters)`
   - Reads selection state from `useIngestionStore`
   - Sorts rows: meetings first, then emails, then documents (can be overridden by user sort in future)

   ```typescript
   // Table header Tailwind:
   // <th>: text-xs font-medium text-gray-500 uppercase tracking-wider px-4 py-3 text-left bg-gray-50
   // <td>: px-4 py-3 text-sm text-gray-900 whitespace-nowrap
   // <tr> hover: hover:bg-gray-50 transition-colors duration-100
   ```

### Task 8: Create Ingestion Page and Register Route (0.25 days)

1. **Create `src/pages/Ingestion.tsx`**

   ```typescript
   import { Navigate } from 'react-router-dom'
   import { useAuthStore } from '../store/authStore'
   import IngestionApproval from '../components/organisms/IngestionApproval'

   export default function Ingestion() {
     const { user } = useAuthStore()
     if (user?.role !== 'admin') return <Navigate to="/" replace />
     return (
       <main className="min-h-screen bg-gray-50">
         <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
           <IngestionApproval />
         </div>
       </main>
     )
   }
   ```

2. **Update router config** — Add `/ingestion` route pointing to `Ingestion` page

### Task 9: Navigation Badge (0.25 days)

1. **Update `src/components/common/Navigation.tsx`** (or equivalent nav file)
   - Add pending count badge next to "Ingestion" nav item
   - Derive pending count from `useIngestion()` cached data (`data?.pending_count`)
   - Badge: `ml-1.5 bg-yellow-400 text-yellow-900 text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center`
   - Only render badge when `pendingCount > 0` and user is admin

### Task 10: Write Tests (0.5 days)

1. **Create `src/tests/components/IngestionApproval.test.tsx`**
   - Renders meeting, email, and document rows correctly
   - Non-admin user sees redirect (or null render)
   - Status badges render with correct color class per status
   - Include toggle calls `PATCH /api/ingestion/{id}` with correct payload
   - Row checkbox adds ID to selection store
   - "Select All" adds all visible IDs to store
   - BulkActionBar appears when items are selected
   - "Approve Selected" calls batch endpoint with correct payload
   - Filter by source type hides non-matching rows
   - Filter by project hides non-matching rows
   - Date range filter hides rows outside range
   - "Clear All Filters" resets to unfiltered list
   - AI Summary expands on click, collapses on second click
   - Empty state renders when no sources match filters
   - Error state renders with retry button

---

## Dev Notes

### Component Architecture

```
Ingestion (Page)
└── IngestionApproval (Organism)
    ├── IngestionFiltersBar (Molecule)
    │   ├── Project select
    │   ├── Source type chips
    │   ├── Date range inputs
    │   └── Active filter chips
    ├── <table> (native — semantic HTML)
    │   ├── <thead> — Select All + column headers
    │   └── <tbody>
    │       ├── MeetingSourceRow (Molecule) [repeating]
    │       │   ├── Select checkbox
    │       │   ├── Call ID, Project, Date/Time, Meeting Type, Source
    │       │   ├── IngestionStatusBadge (Molecule)
    │       │   ├── Include toggle (switch)
    │       │   ├── AISummaryExpander (Molecule)
    │       │   └── Transcript link
    │       ├── EmailSourceRow (Molecule) [repeating]
    │       │   ├── Select checkbox
    │       │   ├── Email ID, Project, Date, Subject, From, Recipient count
    │       │   ├── IngestionStatusBadge (Molecule)
    │       │   ├── Include toggle
    │       │   ├── AISummaryExpander (Molecule)
    │       │   └── Thread link
    │       └── DocumentSourceRow (Molecule) [repeating]
    │           ├── Select checkbox
    │           ├── Doc ID, Project, Upload Date, File Name, Type, Size
    │           ├── IngestionStatusBadge (Molecule)
    │           ├── Include toggle
    │           ├── AISummaryExpander (Molecule)
    │           └── File link
    ├── Empty / Error states
    └── BulkActionBar (Organism, fixed bottom — conditional)
```

### API Contracts

```
GET /api/ingestion
Response 200:
{
  "sources": [
    {
      "id": "src_abc123",
      "project_id": "proj_001",
      "project_name": "Soubim Tower",
      "source_type": "meeting",
      "status": "pending",
      "ai_summary": "Discussed facade material change...",
      "included": false,
      "created_at": "2026-02-18T09:00:00Z",
      "call_id": "call_xyz789",
      "meeting_date": "2026-02-18T09:00:00Z",
      "meeting_type": "Design Review",
      "source_label": "Fireflies",
      "transcript_url": "https://app.fireflies.ai/view/xyz789"
    },
    {
      "id": "src_def456",
      "source_type": "email",
      "status": "pending",
      "email_id": "email_abc",
      "email_date": "2026-02-18T10:30:00Z",
      "subject": "RE: Structural Load Calculations",
      "from_address": "engineer@firm.com",
      "recipient_count": 4,
      "thread_url": null,
      ...
    },
    {
      "id": "src_ghi789",
      "source_type": "document",
      "status": "approved",
      "document_id": "doc_001",
      "upload_date": "2026-02-17T14:00:00Z",
      "file_name": "facade-spec-v3.pdf",
      "file_type": "PDF",
      "file_size_bytes": 2516582,
      "file_url": "https://storage.example.com/docs/facade-spec-v3.pdf",
      ...
    }
  ],
  "total": 42,
  "pending_count": 17
}

PATCH /api/ingestion/{source_id}
Body: { "included": true }
Response 200: { "id": "src_abc123", "status": "approved", "included": true }

POST /api/ingestion/batch
Body: { "source_ids": ["src_abc123", "src_def456"], "action": "approve" }
Response 200: { "updated": 2, "failed": [] }
```

### Status Badge Tailwind Classes

```typescript
// Full badge component pattern:
const STATUS_STYLES = {
  pending:   'bg-yellow-100 text-yellow-800',
  approved:  'bg-green-100 text-green-800',
  rejected:  'bg-red-100 text-red-800',
  processed: 'bg-blue-100 text-blue-800',
} as const

// <span className={cn('inline-flex items-center text-xs font-medium px-2 py-0.5 rounded-full', STATUS_STYLES[status])}>
//   {status}
// </span>
```

### Include Toggle (Switch Pattern)

```typescript
// Tailwind toggle switch (no dependency):
// Track: relative inline-flex h-5 w-9 items-center rounded-full transition-colors
//   checked → bg-blue-600   unchecked → bg-gray-200
// Thumb: inline-block h-4 w-4 transform rounded-full bg-white shadow transition-transform
//   checked → translate-x-4   unchecked → translate-x-0.5

// Optimistic update pattern:
function handleToggle(source: Source) {
  const newIncluded = !source.included
  // Optimistically update local state
  toggleInclude.mutate(
    { id: source.id, included: newIncluded },
    {
      onError: () => {
        toast.error('Failed to update — please try again')
        // React Query will re-fetch and restore server state
      }
    }
  )
}
```

### Filter Chip Tailwind

```typescript
// Active source type chip:
// 'bg-blue-600 text-white text-sm font-medium px-3 py-1.5 rounded-md'

// Inactive source type chip:
// 'bg-white text-gray-700 border border-gray-300 text-sm font-medium px-3 py-1.5 rounded-md hover:bg-gray-50'

// Applied filter chip (removable):
// 'inline-flex items-center gap-1 bg-gray-100 text-gray-700 text-xs px-2.5 py-1 rounded-full'
// X button inside: 'text-gray-400 hover:text-gray-600 cursor-pointer'
```

### Bulk Action Bar Tailwind

```typescript
// Container (sticky bottom):
// 'fixed bottom-0 inset-x-0 bg-white border-t border-gray-200 shadow-lg px-6 py-3 flex items-center justify-between z-30'

// Count label:
// 'text-sm font-medium text-gray-700'

// Approve button:
// 'bg-green-600 text-white text-sm font-medium px-4 py-2 rounded-md hover:bg-green-700 transition-colors'

// Reject button:
// 'border border-red-300 text-red-700 text-sm font-medium px-4 py-2 rounded-md hover:bg-red-50 transition-colors'
```

### Table Layout Tailwind

```
Wrapper:  overflow-x-auto rounded-lg border border-gray-200
Table:    min-w-full divide-y divide-gray-200 bg-white
THead:    bg-gray-50
TH:       px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider
TBody:    divide-y divide-gray-100
TR:       hover:bg-gray-50 transition-colors duration-100
TD:       px-4 py-3 text-sm text-gray-900
```

### Skeleton Loading State

```typescript
// Three skeleton rows per source type:
// <div className="animate-pulse flex items-center space-x-4 px-4 py-3">
//   <div className="h-4 w-4 bg-gray-200 rounded" />             {/* checkbox */}
//   <div className="h-4 w-24 bg-gray-200 rounded" />            {/* ID */}
//   <div className="h-4 w-32 bg-gray-200 rounded" />            {/* project */}
//   <div className="h-4 w-28 bg-gray-200 rounded" />            {/* date */}
//   <div className="h-4 w-20 bg-gray-200 rounded" />            {/* type */}
//   <div className="h-5 w-16 bg-gray-200 rounded-full" />       {/* status badge */}
//   <div className="h-5 w-9 bg-gray-200 rounded-full" />        {/* toggle */}
// </div>
```

### Source Type: manual_input Exclusion

`manual_input` sources bypass the ingestion queue and are never surfaced on this page. The backend `GET /api/ingestion` endpoint already excludes them. The frontend does not need additional filtering for this type, but `SourceType` should not include `'manual_input'` in its union.

### Role Check Pattern

```typescript
// In Ingestion.tsx page — redirect non-admins before rendering anything:
const { user } = useAuthStore()
if (!user || user.role !== 'admin') {
  return <Navigate to="/" replace />
}
```

---

## File List

**New Files:**
- `src/types/ingestion.ts` — TypeScript interfaces: `Source`, `MeetingSource`, `EmailSource`, `DocumentSource`, `IngestionResponse`, `IngestionFilters`, `BatchActionPayload`, `BatchActionResponse`
- `src/services/ingestionService.ts` — API client functions for ingestion endpoints
- `src/store/ingestionStore.ts` — Zustand store for selection state and filters
- `src/hooks/useIngestion.ts` — React Query hook + `useFilteredSources` util
- `src/hooks/useIngestionMutation.ts` — `useToggleInclude` and `useBatchAction` mutations
- `src/components/molecules/IngestionStatusBadge.tsx` — Status badge with color map
- `src/components/molecules/AISummaryExpander.tsx` — Inline expand/collapse summary
- `src/components/molecules/MeetingSourceRow.tsx` — Meeting source table row
- `src/components/molecules/EmailSourceRow.tsx` — Email source table row
- `src/components/molecules/DocumentSourceRow.tsx` — Document source table row
- `src/components/molecules/IngestionFiltersBar.tsx` — Filter bar with chips
- `src/components/organisms/BulkActionBar.tsx` — Sticky bulk action bar
- `src/components/organisms/IngestionApproval.tsx` — Main ingestion organism
- `src/pages/Ingestion.tsx` — Route page with admin guard
- `src/tests/components/IngestionApproval.test.tsx` — Vitest + RTL test suite

**Modified Files:**
- `src/App.tsx` (or router config) — Register `/ingestion` route
- `src/components/common/Navigation.tsx` — Add Ingestion nav link with pending badge (admin only)
- `src/lib/utils.ts` — Add `formatFileSize(bytes: number): string` utility

---

## Testing Strategy

### Unit Tests

```
- ✅ IngestionApproval renders meeting, email, and document rows
- ✅ Non-admin user is redirected (or null render)
- ✅ IngestionStatusBadge renders correct Tailwind class per status
- ✅ Include toggle calls PATCH with correct source_id and included value
- ✅ Optimistic update: toggle reflects immediately before API response
- ✅ Row checkbox adds/removes ID from ingestionStore.selectedIds
- ✅ "Select All" populates selectedIds with all visible row IDs
- ✅ BulkActionBar appears when selectedIds.size > 0
- ✅ BulkActionBar hidden when selection is empty
- ✅ "Approve Selected" calls POST /api/ingestion/batch with action='approve'
- ✅ "Reject Selected" calls POST /api/ingestion/batch with action='reject'
- ✅ After bulk action, selectedIds is cleared
- ✅ Source type chip filter hides non-matching rows
- ✅ Project filter hides non-matching rows
- ✅ Date range filter excludes rows outside range
- ✅ "Clear All Filters" resets all filters
- ✅ Active filter chips are rendered for each active filter
- ✅ AISummaryExpander expands on click, collapses on second click
- ✅ Null AI summary shows "No summary available" placeholder
- ✅ formatFileSize returns correct human-readable strings
- ✅ Empty state renders when filteredSources.length === 0
- ✅ Loading skeleton renders during fetch
- ✅ Error state renders with retry button that calls refetch
- ✅ Navigation badge shows pending_count from useIngestion data
- ✅ Navigation badge hidden when pending_count is 0
```

### Coverage Target
- Minimum: 80%
- Run: `cd decision-log-frontend && npm run test`

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-19 | Created story |
| 2026-02-27 | Implemented all AC — Wave 3 complete |

---

**Related Stories:** 5.3 (uses ProjectItem types as reference), 9.5 (navigation update adds Ingestion link for admins)
**Blocked By:** 7.1 (Backend ingestion API — Source entity, queue endpoints, and batch action endpoint must exist)
**Blocks:** None
