# Story 3.7: Decision Drill-Down Modal

**Story ID:** 3.7
**Assigned to:** @dev
**Sprint:** Sprint 5 (Week 7)
**Status:** Draft
**Estimation:** 8 story points (3-4 days)

---

## Summary

Create a detailed decision drill-down modal that opens when clicking a decision card, showing full context including transcript excerpt, similar past decisions, consistency notes, anomaly flags, and navigation controls.

---

## Acceptance Criteria

- [ ] Modal opens on decision card click
- [ ] Displays complete decision details:
  - [ ] Statement, who, when, why, impacts, consensus, confidence
  - [ ] Transcript excerpt (5-10 min context around decision)
  - [ ] Similar past decisions (3-5 with similarity scores)
  - [ ] Consistency notes
  - [ ] Anomaly flags (if any)
  - [ ] Meeting metadata (type, date, participants)
- [ ] Navigation controls:
  - [ ] Previous/next decision buttons
  - [ ] Close button
  - [ ] Escape key to close
- [ ] Link to full transcript (opens in new tab)
- [ ] Responsive: Full screen on mobile, centered modal on desktop
- [ ] Tests passing: `npm run test` (80%+ coverage)

---

## Tasks

### Task 1: Create Modal Component (1.5 days)

Create `src/components/DrillDownModal.tsx` with full decision detail display, transcript excerpt highlighting, similar decisions list, and keyboard navigation support.

### Task 2: Fetch Decision Detail (0.5 days)

Integrate with `GET /decisions/{id}` endpoint using React Query, handle loading states, and implement error recovery.

### Task 3: Add Transcript Excerpt Viewer (0.75 days)

Display transcript excerpt with timestamp highlighting, speaker identification, and context window (5-10 minutes around decision).

### Task 4: Similar Decisions Display (0.5 days)

Show similar decisions with similarity scores, clickable navigation to related decisions, and visual similarity indicator.

### Task 5: Write Tests (0.75 days)

Test modal rendering, keyboard navigation, decision detail loading, similar decisions display, and accessibility (focus trap, escape key).

---

## Dev Notes

### Modal Architecture

```
DrillDownModal
├── Decision Header (statement, who, when)
├── Main Content
│   ├── Why & Impacts section
│   ├── Consensus indicators
│   ├── Transcript excerpt (highlighted)
│   └── Similar decisions (list with scores)
├── Consistency Notes
├── Anomaly Flags (conditional)
└── Footer (navigation, close)
```

### API Integration

```typescript
const { data: decision } = useQuery({
  queryKey: ['decision', decisionId],
  queryFn: () => api.getDecision(decisionId),
  enabled: !!decisionId,
})
```

---

## File List

**Modified/Created:**
- `src/components/DrillDownModal.tsx` (new)
- `src/components/TranscriptExcerpt.tsx` (new)
- `src/components/SimilarDecisionCard.tsx` (new)
- `tests/components/DrillDownModal.test.tsx` (new)

---

## Testing Strategy

- ✅ Modal open/close
- ✅ Decision detail display
- ✅ Transcript excerpt rendering
- ✅ Similar decisions navigation
- ✅ Keyboard shortcuts (Escape, Arrow keys)
- ✅ Accessibility (ARIA labels, focus management)

---

## Change Log

| Date | Change |
|------|--------|
| 2026-02-08 | Created story |

---

**Related Stories:** 3.5 (Timeline), 3.9 (API Endpoints)
**Blocked By:** 3.5
**Blocks:** None
