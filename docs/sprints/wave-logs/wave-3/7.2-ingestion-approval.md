# Wave 3 Log: Story 7.2 — Frontend Ingestion Approval Page

**Story:** 7.2 — Frontend Ingestion Approval Page
**Wave:** 3
**Status:** Complete
**Date:** 2026-02-27

---

## Summary

Built the `/ingestion` route with `IngestionApproval` organism. Admin users (role: `director`) can review, approve, and reject incoming sources (meetings, emails, documents). The page includes per-row Include toggles, AI summary expanders, bulk actions, filters by project/source type/date, status indicators, and a pending-count badge in the Navigation.

## Files Created

| File | Purpose |
|------|---------|
| `src/types/ingestion.ts` | TypeScript interfaces for Source types, IngestionResponse, BatchActionPayload, IngestionFilters |
| `src/services/ingestionService.ts` | API client functions for GET /ingestion, PATCH /ingestion/:id, POST /ingestion/batch, GET /ingestion/count |
| `src/store/ingestionStore.ts` | Zustand store for selectedIds (Set) and filters state |
| `src/hooks/useIngestion.ts` | React Query hook for fetching sources + useFilteredSources utility |
| `src/hooks/useIngestionMutation.ts` | useToggleInclude and useBatchAction mutation hooks |
| `src/components/molecules/IngestionStatusBadge.tsx` | Status badge with color-coded Tailwind classes per status |
| `src/components/molecules/AISummaryExpander.tsx` | Inline expand/collapse for AI summary text |
| `src/components/molecules/MeetingSourceRow.tsx` | Table row for meeting sources |
| `src/components/molecules/EmailSourceRow.tsx` | Table row for email sources |
| `src/components/molecules/DocumentSourceRow.tsx` | Table row for document sources |
| `src/components/molecules/IngestionFiltersBar.tsx` | Filter bar with project dropdown, source type chips, date range inputs, active filter chips |
| `src/components/organisms/BulkActionBar.tsx` | Fixed bottom bar for bulk approve/reject actions |
| `src/components/organisms/IngestionApproval.tsx` | Main organism composing all sub-components |
| `src/pages/Ingestion.tsx` | Route page with admin guard (director role check) |
| `src/tests/components/IngestionApproval.test.tsx` | 34 tests covering rendering, access control, toggles, bulk actions, filters, states |

## Files Modified

| File | Change |
|------|--------|
| `src/App.tsx` | Added `/ingestion` route with ProtectedRoute wrapper |
| `src/components/common/Navigation.tsx` | Added IngestionNavLink with pending count badge (admin only) |
| `src/lib/utils.ts` | Added `formatFileSize(bytes)` utility function |
| `src/tests/components/Navigation.test.tsx` | Added QueryClientProvider wrapper + ingestionService mock |

## Test Results

- **34 new tests** in `IngestionApproval.test.tsx` — all passing
- **168 total tests** across all test files — all passing (2 pre-existing skips)
- Zero regressions in existing tests

## Architecture Decisions

- Used `react-query` v3 (project standard, not `@tanstack/react-query`)
- Admin role check uses `user.role === 'director'` per auth.ts User type definition
- Navigation pending badge uses separate `GET /api/ingestion/count` endpoint for lightweight polling
- Filters applied client-side (no additional API calls per filter change)
- Source rows sorted: meetings first, then emails, then documents
- Include toggle uses role="switch" with aria-checked for accessibility
- BulkActionBar uses `aria-live="polite"` for screen reader announcements
