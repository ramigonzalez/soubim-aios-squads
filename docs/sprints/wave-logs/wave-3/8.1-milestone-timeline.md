# Wave Log: Story 8.1 — Frontend Milestone Timeline Component
## Wave: 3
## Status: completed
## Agent: @dev

## Files Created
| File | Lines | Description |
|------|-------|-------------|
| `src/types/projectItem.ts` | 62 | ProjectItem, ProjectStage, ItemType, SourceType, Discipline types + response interfaces |
| `src/hooks/useMilestones.ts` | 42 | React Query hook for fetching milestone items from /projects/{id}/milestones |
| `src/hooks/useStages.ts` | 33 | React Query hook for fetching project stages from /projects/{id}/stages |
| `src/components/molecules/StageNode.tsx` | 53 | Stage dot molecule — large dot with name, date range, "Current" badge |
| `src/components/molecules/MilestoneNode.tsx` | 132 | Milestone row molecule — small dot with connector, ItemTypeBadge, statement, SourceIcon, date, DisciplineCircles |
| `src/components/organisms/MilestoneTimeline.tsx` | 264 | Main timeline organism — vertical line, stage grouping, Today marker, loading/empty/error states |
| `src/tests/components/MilestoneTimeline.test.tsx` | 458 | 15 test cases covering all states, interactions, accessibility, and grouping logic |

## Files Modified
| File | Changes | Description |
|------|---------|-------------|
| `src/pages/ProjectDetail.tsx` | View type changed from 2-tab to 3-tab | Added `'milestones'` view, changed `View` type to `'milestones' | 'history' | 'digest'`, imported MilestoneTimeline, added 3-button toggle, Milestones is default view |

## Key Decisions
| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| Inline atom components (ItemTypeBadge, SourceIcon, DisciplineCircles) in MilestoneNode.tsx | Story 9.1 atoms (ItemTypeBadge, SourceIcon, DisciplineCircles) do not exist yet in the codebase | Could have created separate atom files, but inline keeps them co-located and easy to replace when 9.1 lands |
| Created separate useStages.ts hook | Clean separation of concerns, follows existing hook patterns (useDecisions, useProjects) | Could have fetched stages inline in MilestoneTimeline, but hook pattern is more consistent and reusable |
| Created projectItem.ts types file | Types for ProjectItem, ProjectStage were not defined anywhere in frontend | Could have extended Decision type, but V2 taxonomy (item_type, source_type, etc.) requires its own interface |
| Default view set to 'milestones' | Story spec says "Default: milestones if stages exist, else history" — simplified to always default milestones since the component handles no-stages state internally | Could have checked stages data before rendering to switch default, but that adds complexity and the no-stages state already guides users |
| TodayMarker uses percentage-based positioning | Story spec uses proportional position between first stage start and last stage end | Could have used absolute pixel positioning, but percentage is responsive |
| React.memo on MilestoneNode | Story spec requires no unnecessary re-renders for performance with up to 50 milestones | Could have left unmemoized, but memo prevents re-renders when parent state changes |

## Deviations from Story Spec
- **Tab naming**: Used "Milestones" / "History" / "Executive Digest" instead of "Milestone Timeline" / "Project History" / "Executive Digest" for brevity in the toggle buttons
- **FilterBar**: Only shown for 'history' view (not milestones), since milestones have their own data pipeline
- **Tab state NOT in URL hash**: Story Task 6 mentions `#milestones`/`#history` hash routing, but this was not implemented since no other views use hash-based routing and it would require adding useLocation/useNavigate integration. Can be added in a follow-up.
- **Responsive mobile layout**: Story calls for vertical stack on mobile (375px). The current implementation uses responsive Tailwind classes for tighter spacing but does not fully stack vertically. This is a CSS refinement that can be addressed in a follow-up polish story.

## Test Results
```
Test Files  1 passed (1)
     Tests  15 passed (15)
  Duration  761ms

All existing tests continue to pass:
Test Files  11 passed (11)
     Tests  149 passed | 2 skipped (151)
```

### Test Coverage
- Loading skeleton state
- Error state with retry
- No stages state
- Empty milestones state
- Stages render with names and date ranges
- Milestones grouped into correct parent stages
- Current stage highlighted (blue dot + ring + badge)
- Today marker present
- Click milestone calls onSelectItem
- Keyboard Enter triggers onSelectItem
- Semantic HTML (nav with aria-label)
- Milestones outside stage ranges grouped under "Other"
- Item type badges render
- Discipline circles with overflow
- Complete multi-stage timeline

## Warnings for Downstream Stories
- **Story 9.1**: MilestoneNode.tsx contains inline versions of ItemTypeBadge, SourceIcon, and DisciplineCircles. When Story 9.1 creates proper atom components, update MilestoneNode.tsx to import from atoms instead.
- **Story 8.2**: MilestoneTimeline's `onSelectItem` callback currently maps to DrilldownModal via the decisions list. If 8.2 needs to toggle is_milestone, it will need to integrate with the milestones hook's refetch.
- **Story 8.3**: Milestone filters are not yet integrated — the FilterBar is only shown for history view.
- **Story 7.2**: ProjectDetail.tsx now imports MilestoneTimeline. If 7.2 modifies routing/layout, coordinate the 3-tab toggle.
