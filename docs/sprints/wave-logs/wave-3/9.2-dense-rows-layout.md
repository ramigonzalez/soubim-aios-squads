# Wave 3 — Story 9.2: Dense Rows Layout & Visual Separation

**Agent:** @dev
**Status:** Complete
**Date:** 2026-02-27

---

## Summary

Redesigned the existing Timeline organism into a Dense Rows layout with three visual layers:
1. **UPPERCASE sticky date headers** — `FEB 8, 2026` format with item count badges
2. **Collapsible source group accordions** — colored left border (indigo for meetings, sky for emails, orange for documents), expand/collapse with chevron rotation
3. **Compact single-line item rows** — ~32-40px height with ItemTypeBadge, statement, DisciplineCircles, who, date, and admin milestone star

## Files Created

| File | Purpose |
|------|---------|
| `src/components/molecules/ProjectItemRow.tsx` | Dense single-line item row molecule |
| `src/components/molecules/SourceGroupAccordion.tsx` | Collapsible source group with colored left border |
| `src/tests/components/ProjectItemRow.test.tsx` | 8 tests for item row rendering, clicks, keyboard, milestone star |
| `src/tests/components/SourceGroupAccordion.test.tsx` | 13 tests for accordion expand/collapse, border colors, ARIA |
| `src/tests/components/Timeline.test.tsx` | 12 tests for Dense Rows layout, date headers, grouping, states |

## Files Modified

| File | Change |
|------|--------|
| `src/components/organisms/Timeline.tsx` | Major redesign: replaced MeetingGroup card layout with Dense Rows (SourceGroupAccordion + ProjectItemRow). New `buildDenseGroups()` and `buildDenseGroupsByDiscipline()` grouping functions. Updated skeleton/empty/error states. |
| `src/lib/utils.ts` | Added `formatDenseDate()` function for UPPERCASE date formatting with local date parsing |

## Key Decisions

- **Timezone handling**: `formatDenseDate()` parses YYYY-MM-DD strings as local dates (like existing `formatDate()`) to avoid timezone shift issues. `getDateKey()` also uses local date components.
- **Source border colors**: Meeting sources use `border-l-indigo-400`, emails use `border-l-sky-400`, documents use `border-l-orange-400`. Manual input items render without a source group wrapper.
- **Backward compatibility**: Timeline props interface preserved (`decisions`, `onSelectDecision`, `groupBy`, `isLoading`, `error`, `onRetry`) so ProjectDetail.tsx works without changes.
- **Accordion default state**: Expanded if <=5 items, collapsed if >5 items (matching V1 MeetingGroup behavior).

## Test Results

```
Test Files  22 passed (22)
Tests       250 passed | 2 skipped (252)
```

All 34 new tests pass. Zero regressions.

## Dependencies Used

- Story 9.1 atoms: `ItemTypeBadge`, `SourceIcon`, `DisciplineCircles`
- Story 5.3 types: `ProjectItem`, `SourceType`, `Discipline`
- Existing utils: `cn()`, `getDisciplineNodeColor()`
- Lucide icons: `ChevronDown`, `Star`, `Calendar`, `AlertCircle`
